<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>/* Isabelle fonts */

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('../../fonts/IsabelleDejaVuSans.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('../../fonts/IsabelleDejaVuSans-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('../../fonts/IsabelleDejaVuSans-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans';
  src: url('../../fonts/IsabelleDejaVuSans-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('../../fonts/IsabelleDejaVuSansMono.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('../../fonts/IsabelleDejaVuSansMono-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('../../fonts/IsabelleDejaVuSansMono-Oblique.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Sans Mono';
  src: url('../../fonts/IsabelleDejaVuSansMono-BoldOblique.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('../../fonts/IsabelleDejaVuSerif.ttf') format('truetype');
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('../../fonts/IsabelleDejaVuSerif-Bold.ttf') format('truetype');
  font-weight: bold;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('../../fonts/IsabelleDejaVuSerif-Italic.ttf') format('truetype');
  font-style: italic;
}

@font-face {
  font-family: 'Isabelle DejaVu Serif';
  src: url('../../fonts/IsabelleDejaVuSerif-BoldItalic.ttf') format('truetype');
  font-weight: bold;
  font-style: italic;
}

@font-face {
  font-family: 'Vacuous';
  src: url('../../fonts/Vacuous.ttf') format('truetype');
}


/* standard document markup */

dt {
  float: left;
  clear: left;
  padding-right: 0.5em;
  font-weight: bold;
}

body {
  color: #000000;
  background-color: #FFFFFF;
}

.head     { background-color: #FFFFFF; }
.source   {
  direction: ltr; unicode-bidi: bidi-override;
  background-color: #FFFFFF;
  padding: 10px;
  font-family: "Isabelle DejaVu Sans Mono", monospace;
}

.theories { background-color: #FFFFFF; padding: 10px; }
.sessions { background-color: #FFFFFF; padding: 10px; }
.document { white-space: normal; font-family: "Isabelle DejaVu Serif", serif; }

.name     { font-style: italic; }
.filename { font-family: "Isabelle DejaVu Sans Mono", monospace; }


/* basic syntax markup */

.hidden         { font-family: Vacuous; font-size: 1%; color: rgba(255,255,255,0); }
.control        { font-weight: bold; font-style: italic; }

.binding        { color: #336655; }
.tfree          { color: #A020F0; }
.tvar           { color: #A020F0; }
.free           { color: #0000FF; }
.skolem         { color: #D2691E; }
.bound          { color: #008000; }
.var            { color: #00009B; }
.numeral        { }
.literal        { font-weight: bold; }
.delimiter      { }
.inner_numeral  { color: #FF0000; }
.inner_quoted   { color: #FF00CC; }
.inner_cartouche { color: #CC6600; }
.comment1       { color: #CC0000; }
.comment2       { color: #FF8400; }
.comment3       { color: #6600CC; }
.dynamic        { color: #7BA428; }
.class_parameter_color { color: #D2691E; }

.bold           { font-weight: bold; }

.main           { color: #000000; }
.command        { font-weight: bold; }
.keyword        { font-weight: bold; }
.keyword1       { color: #006699; }
.keyword2       { color: #009966; }
.keyword3       { color: #0099FF; }
.quasi_keyword  { color: #9966FF; }
.operator       { color: #323232; }
.string         { color: #FF00CC; }
.alt_string     { color: #CC00CC; }
.verbatim       { color: #6600CC; }
.cartouche      { color: #CC6600; }
.comment        { color: #CC0000; }
.improper       { color: #FF5050; }
.antiquote      { color: #6600CC; }
.raw_text       { color: #6600CC; }
.plain_text     { color: #CC6600; }
.bad            { background-color: #FF6A6A; }
.quoted         { background-color: rgba(139,139,139,0.05); }
.antiquoted     { background-color: rgba(255,200,50,0.1); }


/* message background */

.writeln_message      { background-color: #F0F0F0; }
.information_message  { background-color: #DCEAF3; }
.tracing_message      { background-color: #F0F8FF; }
.warning_message      { background-color: #EEE8AA; }
.legacy_message       { background-color: #EEE8AA; }
.error_message        { background-color: #FFC1C1; }


/* message underline */

.writeln { border-bottom: 1px dotted #C0C0C0; }
.information { border-bottom: 1px dotted #C1DFEE; }
.warning { border-bottom: 1px dotted #FF8C00; }
.legacy { border-bottom: 1px dotted #FF8C00; }
.error { border-bottom: 1px dotted #B22222; }


/* tooltips */

.writeln { position: relative; display: inline-block; }
.information { position: relative; display: inline-block; }
.warning { position: relative; display: inline-block; }
.legacy { position: relative; display: inline-block; }
.error { position: relative; display: inline-block; }

.writeln:hover .tooltip { visibility: visible; }
.information:hover .tooltip { visibility: visible; }
.warning:hover .tooltip { visibility: visible; }
.legacy:hover .tooltip { visibility: visible; }
.error:hover .tooltip { visibility: visible; }

.tooltip {
  top: -0.5ex;
  left: 5em;
  visibility: hidden;
  width: 50em;
  border: 1px solid #808080;
  padding: 1px 1px;
  background-color: #FFFFE9;
  position: absolute;
  z-index: 1;
}

.tooltip pre { margin: 1px; white-space: pre-wrap; }
</style><title>Theory "scheduler_verify"</title></head>
<body><pre class="source"><span class="keyword1"><span class="command">theory</span></span> scheduler_verify

<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"bus_verify"</span> <span class="quoted">"../des/des_scheduler"</span> <span class="quoted">"../req/req_scheduler"</span>  <span class="quoted">"../invariant/invariant_8"</span>
         <span class="quoted">"../invariant/invariant_bus3"</span>  <span class="quoted">"../invariant/invariant_bus5"</span> <span class="quoted">"../invariant/invariant_2"</span>
         <span class="quoted">"../invariant/invariant_12"</span> <span class="quoted">"../invariant/invariant_17"</span> <span class="quoted">"../invariant/invariant_18"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*
  Some Auxiliary Lemmas 
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> index_find_aux <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"index <span class="free">al</span> <span class="free">a</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>index <span class="free">al</span> <span class="free">a</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span> <span class="main">⟹</span> find <span class="free">P</span> <span class="free">al</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> find_Some_iff index_less_size_conv nth_index<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> index_find_aux1 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟹</span>  <span class="free">i</span> <span class="main">&lt;</span> int <span class="main">(</span>length <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="free">i</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> 
              <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> nat <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> find <span class="free">P</span> <span class="free">al</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> int <span class="main">(</span>index <span class="free">al</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">i</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> find_Some_iff index_def myListIndexAux4 nat_eq_iff2 not_less_iff_gr_or_eq<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> index_find_aux2 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟹</span>  <span class="free">i</span> <span class="main">&lt;</span> int <span class="main">(</span>length <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="free">i</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> nat <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> find <span class="free">P</span> <span class="free">al</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟹</span> ACB.prio <span class="free">a</span> <span class="main">=</span> ACB.prio <span class="main">(</span><span class="free">al</span> <span class="main">!</span> nat <span class="free">i</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> findSomeD index_find_aux1 nat_int nth_index<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> index_find_aux3 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span><span class="main">≥</span><span class="main">0</span> <span class="main">⟹</span>  <span class="free">i</span> <span class="main">&lt;</span> int <span class="main">(</span>length <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="free">i</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
              <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> nat <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> find <span class="free">P</span> <span class="free">al</span> <span class="main">=</span> Some <span class="bound">a</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> find_Some_iff nat_int.Rep_inverse nat_less_eq_zless zero_le_imp_eq_int<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_filter_aux0 <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span>  <span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">]</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> "</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> filter_append hd_drop_conv_nth take_hd_drop<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_filter_aux1 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> "</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 add.right_neutral filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> filter_append hd_drop_conv_nth take_add take_eq_Nil take_hd_drop<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_filter_aux2 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> filter_False in_set_conv_nth length_take less_imp_le_nat min.absorb2 nth_take<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_filter_aux3 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
     map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_filter_aux2<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_map_filter_aux0 <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span>  <span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span>   "</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> take_filter_aux0 
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> list.simps<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> map_append<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_map_filter_aux1 <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span>   "</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> take_filter_aux1
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">metis</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_map_filter_aux2 <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span>  <span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="free">i</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
      map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>     
      <span class="main">[</span><span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>  map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span> "</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> self_append_conv2 take_map_filter_aux0<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> take_filter_length_aux0 <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">"<span class="free">i</span><span class="main">&lt;</span>length <span class="free">sl</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">sl</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> 
        int <span class="main">(</span>length <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">sl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> int <span class="main">(</span>length <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="free">i</span> <span class="free">sl</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> "</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> take_filter_aux0
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_eq_plus1 length_append list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> of_nat_1 of_nat_add<span class="main">)</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> take_filter_last_aux0 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">sl</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">sl</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">sl</span><span class="main">!</span><span class="free">i</span> <span class="main">=</span> last <span class="main">(</span>filter <span class="free">Q</span> <span class="main">(</span>take <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="free">sl</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> last_snoc take_filter_aux0<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> and_not_if_aux <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="main">(</span><span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span><span class="main">⟶</span><span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>  <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">C</span><span class="main">)</span> "</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_filter_aux <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span> length <span class="free">al</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> map <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Nil_is_map_conv filter_False index_less_size_conv nth_index<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_aux<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"
    distinct <span class="main">(</span>map <span class="free">T</span> <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="free">r</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> 
    <span class="free">T</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">⟹</span> 
    <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">r</span> <span class="main">⟶</span> <span class="free">T</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">r</span> <span class="main">⟶</span> <span class="free">T</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">t</span> <span class="main">⟹</span>
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">[</span><span class="free">r</span><span class="main">:=</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">r</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> 
      map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span> length <span class="free">al</span><span class="main">.</span> 
        <span class="bound">i</span><span class="main">≠</span><span class="free">r</span> <span class="main">⟶</span><span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">[</span><span class="free">r</span><span class="main">:=</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">r</span><span class="main">)</span><span class="main">]</span> <span class="main">!</span> <span class="bound">i</span> <span class="main">=</span> 
        map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span> <span class="main">!</span> <span class="bound">i</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">[</span><span class="free">r</span><span class="main">:=</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">r</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> 
      map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">T</span> <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Un_insert_right insert_iff length_list_update length_map nth_equalityI nth_list_update_eq nth_map<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_eq_iff_index_eq <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_ACB_aux1<span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"
    distinct <span class="main">(</span>map ACB.actorID <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="free">ra</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span> 
    ACB.actorID <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">ra</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">⟹</span> 
    <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">ra</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">t</span><span class="main">}</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">ra</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">ra</span> <span class="main">⟶</span> ACB.actorID <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">ra</span> <span class="main">⟶</span> ACB.actorID <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="free">t</span> <span class="main">⟹</span>
    <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">[</span><span class="free">ra</span><span class="main">:=</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">ra</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> 
      map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span><span class="main">∈</span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">t</span><span class="main">}</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">P</span> <span class="bound">a</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span> <span class="free">al</span>
"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_set_aux<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> map_set_ACB_aux2 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">r</span> <span class="main">&lt;</span> length <span class="free">pl</span> <span class="main">⟹</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span> <span class="free">pl</span><span class="main">)</span> <span class="main">=</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="free">pl</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>ActorPluginInfo.actorID <span class="main">(</span><span class="free">pl</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">}</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Un_insert_right image_insert sup_bot.right_neutral take_insert_nth<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> record_acbList_aux0<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">a</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList<span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">M</span>  <span class="main">=</span> <span class="free">N</span> 
        <span class="main">⟹</span> <span class="free">a</span><span class="main">⦇</span>acbList<span class="main">:=</span> <span class="free">M</span> <span class="main">⦈</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList <span class="main">:=</span> <span class="free">N</span> <span class="main">⦈</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> record_acbList_aux1<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">a</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList<span class="main">:=</span> <span class="free">P</span><span class="main">⦈</span>  <span class="main">⟹</span> acbList <span class="free">a</span> <span class="main">=</span> <span class="free">P</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_map_remove1_aux <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" distinct <span class="main">(</span>map ACB.actorID <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="free">ra</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span>
    distinct <span class="main">(</span>map ACB.actorID <span class="main">(</span>remove1 <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> distinct_conv_nth distinct_map distinct_remove1 index_map_inj_on index_nth_id length_map notin_set_remove1 nth_map nth_mem set_remove1_subset<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> remove1_filter_aux0 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">" distinct <span class="free">al</span> <span class="main">⟹</span> <span class="free">i</span><span class="main">&lt;</span>length <span class="free">al</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="main">⟹</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span> <span class="free">i</span> <span class="main">≠</span> <span class="bound">j</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span>
             <span class="main">⟹</span> remove1 <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">al</span> <span class="main">=</span> filter <span class="free">P</span> <span class="free">al</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"set <span class="main">(</span>remove1 <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> set <span class="free">al</span> <span class="main">-</span> <span class="main">{</span><span class="free">al</span><span class="main">!</span><span class="free">i</span><span class="main">}</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Diff_insert_absorb filter_True filter_cong filter_remove1 index_less_size_conv mk_disjoint_insert nth_index remove1_idem set_minus_filter_out<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_P_Q <span class="main">:</span><span class="quoted"><span class="quoted"><span class="language">"filter <span class="free">P</span> <span class="main">(</span>filter <span class="free">Q</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> filter <span class="free">Q</span> <span class="main">(</span>filter <span class="free">P</span> <span class="free">al</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">al</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_set_notin_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"distinct <span class="main">(</span>map ACB.actorID <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">∀</span><span class="bound"><span class="bound">t</span></span><span class="main">&lt;</span>length <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span><span class="main">.</span>
       ACB.actorID <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span> <span class="main">!</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="free">faID</span> <span class="main">⟹</span>
     filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span> <span class="main">=</span> 
     filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">al</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> filter_True index_less_size_conv nth_index singletonD<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">al</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span> <span class="main">=</span> 
                      filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">al</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_P_Q<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="free">A</span>"</span></span></span></span> <span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_set_notin_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" distinct <span class="main">(</span>map ACB.actorID <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">∀</span><span class="bound"><span class="bound">t</span></span><span class="main">&lt;</span>length <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span><span class="main">.</span> ACB.actorID <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="free">faID</span> <span class="main">⟹</span>
    acbList <span class="free">a</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">)</span> <span class="free">al</span> <span class="main">⟹</span>
    acbList <span class="free">a</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span> <span class="main">)</span> <span class="free">al</span> "</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> filter_set_notin_aux 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filter_set_notin_aux2<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" distinct <span class="main">(</span>map ACB.actorID <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> 
    <span class="main">∀</span><span class="bound"><span class="bound">t</span></span><span class="main">&lt;</span>length <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span><span class="main">.</span> ACB.actorID <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="free">faID</span> <span class="main">⟹</span>
    <span class="free">a</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⟹</span>
    <span class="free">a</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span> <span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">⦈</span> "</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> filter_set_notin_aux1<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">xt</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> remove1_filter_aux1<span class="main">:</span>
      <span class="quoted"><span class="quoted"><span class="language">"distinct <span class="main">(</span>map ACB.actorID <span class="free">al</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">ra</span> <span class="main">&lt;</span> length <span class="free">al</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound"><span class="bound">t</span></span><span class="main">&lt;</span><span class="free">ra</span><span class="main">.</span> ACB.actorID <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> <span class="free">faID</span> <span class="main">⟹</span>
       distinct <span class="main">(</span>map ACB.actorID <span class="free">xl</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="free">al</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">xl</span> <span class="main">⟹</span>
       ACB.actorID <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">=</span> <span class="free">faID</span> <span class="main">⟹</span>
        remove1 <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="free">al</span> <span class="main">=</span>  filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">xl</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≠</span> <span class="free">ra</span> <span class="main">⟶</span> ACB.actorID <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∉</span> <span class="main">{</span><span class="free">faID</span><span class="main">}</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command">using</span></span> nth_eq_iff_index_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">al</span> <span class="main">=</span> remove1 <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="free">al</span> "</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> distinct_map insert_iff remove1_filter_aux0<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="free">xl</span><span class="main">)</span> <span class="main">=</span>
                      filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">xl</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">xl</span><span class="main">)</span> <span class="main">=</span> 
                      filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">∪</span><span class="main">{</span><span class="free">faID</span><span class="main">}</span><span class="main">)</span> <span class="free">xl</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> filter_P_Q<span class="main">)</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> index_take_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">r</span> <span class="main">&lt;</span> length <span class="free">pl</span> <span class="main">⟹</span>
   find_index <span class="free">P</span> <span class="main">(</span>take <span class="free">r</span> <span class="free">pl</span><span class="main">)</span> <span class="main">=</span>  <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">pl</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span>  <span class="main">⟹</span>
   find_index <span class="free">P</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span> <span class="free">pl</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_leI find_index_eq_size_conv find_index_less_size_conv length_take lessI less_antisym min.absorb2 nth_append nth_find_index nth_mem nth_take take_hd_drop<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> index_take_min_aux0 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="free">r</span> <span class="main">&lt;</span> length <span class="free">pl</span> <span class="main">⟹</span>
   find_index <span class="main">(</span><span class="main">λ</span><span class="bound">pi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">pi</span><span class="main">)</span> <span class="main">(</span>take <span class="free">r</span> <span class="free">pl</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>length <span class="free">pl</span><span class="main">)</span> <span class="free">r</span> <span class="main">⟹</span>
   <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">pl</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span>  <span class="main">⟹</span>
   find_index <span class="main">(</span><span class="main">λ</span><span class="bound">pi</span><span class="main">.</span> <span class="free">P</span> <span class="bound">pi</span><span class="main">)</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span> <span class="free">pl</span><span class="main">)</span> <span class="main">=</span> min <span class="main">(</span>length <span class="free">pl</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> index_take_aux0<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function appendScheduleMsg
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendScheduleMsg <span class="main">:</span> 
      <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> Des_appendScheduleMsg <span class="free">msg</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_appendScheduleMsg <span class="free">sche</span> <span class="free">msg</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_appendScheduleMsg_def Re_appendScheduleMsg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="comment1">(* 
  Refinement Verification of Function yieldActor
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_yieldActor <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> Des_yieldActor <span class="free">anActorID</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="free">anActorID</span><span class="main">)</span><span class="main">∧</span>
              <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="free">anActorID</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_yieldActor_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>  <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> Re_yieldAcb <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="free">anActorID</span><span class="main">)</span> <span class="main">∧</span> <span class="free">len</span> <span class="main">=</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
               "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def condition_def invariant_8_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r
    <span class="keyword1"><span class="command">unfolding</span></span> Re_yieldActor_def Re_yieldAcb_def Let_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_eq_iff_index_eq nth_find_index <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> myListIndexAux3 nth_mem size_eq_find_index_conv<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> myListIndexAux3 neqE nth_mem size_eq_find_index_conv<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_SucE <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="language"><span class="operator">-</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"distinct <span class="main">(</span>map ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span> <span class="main">&lt;</span> length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span>"</span></span></span>
        <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">anActorID</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span>"</span></span></span>
        <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span>"</span></span></span>
        <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">n</span> <span class="main">&lt;</span> length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">∨</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="free">anActorID</span> <span class="main">∨</span> <span class="skolem">r</span> <span class="main">=</span> <span class="bound">n</span>"</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> a3 a2 a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> distinct_conv_nth length_map nth_map<span class="main">)</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">as</span><span class="main">.</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="main">(</span><span class="bound">a</span><span class="main">::</span>ACB<span class="main">)</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="bound">as</span> <span class="main">=</span> length <span class="bound">as</span> <span class="main">∨</span> ACB.actorID <span class="main">(</span><span class="bound">as</span> <span class="main">!</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="bound">as</span><span class="main">)</span> <span class="main">=</span> <span class="free">anActorID</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> a3 myListIndexAux3 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> f5 a4 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> nat_less_le<span class="main">)</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">sche</span> <span class="main">⦇</span>acbList <span class="main">:=</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">[</span><span class="skolem">r</span> <span class="main">:=</span> <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">⦇</span>prio <span class="main">:=</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">]</span><span class="main">⦈</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">⦇</span>acbList <span class="main">:=</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">[</span>find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">:=</span> <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">⦇</span>prio <span class="main">:=</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">]</span><span class="main">⦈</span>"</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_yieldActor_def Re_yieldAcb_def Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_find_index 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="comment1">(* 
  Refinement Verification of Function activateActor
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_activateActor <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> Des_activateActor <span class="free">anActorID</span> <span class="free">anActorName</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span><span class="main">)</span><span class="main">∧</span>
              <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_activateActor_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>  <span class="bound">i</span><span class="main">≥</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span> nat <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> Re_activateAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">anActorID</span><span class="main">)</span> <span class="main">∧</span> <span class="free">len</span> <span class="main">=</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> nat <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> Re_activateActor_def Re_activateAcb1_def Let_def Re_activateAcb2_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
     <span class="keyword1"><span class="command">using</span></span> nth_find_index <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def invariant_8_def 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> len r
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">i</span><span class="main">≥</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">len</span> <span class="main">=</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">pi</span> <span class="main">=</span> <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="main">(</span>nat <span class="skolem">r</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">r</span> <span class="main">&lt;</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span> nat <span class="skolem">r</span><span class="main">.</span> <span class="main">¬</span> Re_activateAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">anActorID</span><span class="main">)</span> <span class="main">∧</span> 
                      Re_activateAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="main">(</span>nat <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="free">anActorID</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span> nat <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> Re_activateAcb2 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span>swarmID <span class="main">(</span>ACB.pSwarmInfo <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="main">(</span>nat <span class="skolem">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="free">anActorName</span><span class="main">)</span>
               "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> nat <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def invariant_8_def       
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Re_activateActor_def Let_def Re_activateAcb1_def Let_def Re_activateAcb2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
    <span class="keyword1"><span class="command">using</span></span> zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ra
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> Re_activateAcb1 <span class="bound">a</span> <span class="free">anActorID</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">=</span> nat <span class="skolem">r</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Re_activateActor_def Let_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Re_activateAcb2_def linorder_neqE_nat myListIndexAux1 myListIndexAux3 nth_find_index<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Re_activateAcb2_def linorder_neqE_nat myListIndexAux1 myListIndexAux3 nth_find_index<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_activateAcb2_def nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_activateAcb2_def nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Re_activateAcb2_def myListIndexAux1 myListIndexAux3 nat_int nat_less_eq_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_activateAcb2_def nat_int.Rep_inverse zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_activateAcb2_def nat_int.Rep_inverse zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Re_activateAcb2_def linorder_neqE_nat myListIndexAux1 myListIndexAux3 nat_int nat_less_eq_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Re_activateAcb2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> nat_int.Rep_inverse zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> linorder_neqE_nat myListIndexAux1 myListIndexAux3 nat_int nat_less_eq_zless nat_mono_iff zless_nat_conj<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_activateActor_def Re_activateAcb1_def Let_def Re_activateAcb2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> length_map nat_le_0 nat_less_iff nth_eq_iff_index_eq nth_find_index nth_map of_nat_le_0_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* 
  Refinement Verification of Function switchToActor
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> req_des_switchToActor <span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> Des_switchToActor <span class="free">anActorID</span> <span class="free">anActorName</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span><span class="main">)</span><span class="main">∧</span>
              <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_switchToActor_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">len</span> <span class="main">=</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> Re_switchAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="free">anActorName</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> nat <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Re_switchToActor_def Let_def Re_switchAcb1_def Re_switchAcb2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> nth_find_index <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> len r
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def invariant_8_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≥</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">len</span> <span class="main">=</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="skolem">r</span> <span class="main">&lt;</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="skolem">r</span><span class="main">.</span> <span class="main">¬</span> Re_switchAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="free">anActorName</span> <span class="main">)</span> <span class="main">∧</span> 
               <span class="main">(</span>Re_switchAcb1 <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="free">anActorName</span> <span class="main">∧</span> ACB.state <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span> <span class="main">(</span>nat <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="bound">i</span><span class="main">.</span> <span class="main">¬</span> Re_switchAcb2 <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="free">anActorID</span><span class="main">)</span>
               "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> nat <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
    <span class="keyword1"><span class="command">unfolding</span></span> Re_switchToActor_def Let_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Re_switchAcb1_def linorder_neqE_nat myListIndexAux3 nat_less_le<span class="main">)</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Re_switchAcb1_def linorder_neqE_nat myListIndexAux3 nat_less_le<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_switchAcb1_def zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_switchAcb1_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> Re_switchAcb1_def zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span><span class="main"><span class="keyword3">+</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> pi ra
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"find_index <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> Re_switchAcb1 <span class="bound">a</span> <span class="free">anActorName</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">=</span> nat <span class="skolem">r</span>"</span></span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Re_switchToActor_def Let_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_switchAcb2_def less_irrefl_nat linorder_neqE_nat myListIndexAux1 myListIndexAux3<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_switchAcb2_def nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_switchAcb2_def nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Re_switchAcb2_def myListIndexAux1 myListIndexAux3 nat_less_iff<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_switchAcb2_def nat_int.Rep_inverse zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_switchAcb2_def nat_eq_iff zless_nat_eq_int_zless<span class="main">)</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> myListIndexAux4<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_switchToActor_def Let_def Re_switchAcb1_def Re_switchAcb2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_find_index <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(* 
  Refinement Verification of Function getActorNameByID 
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_getActorNameByID <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_getActorNameByID <span class="free">anActorID</span>  
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">=</span> Re_getActorNameByID <span class="free">sche</span> <span class="free">anActorID</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_getActorNameByID_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>  fst <span class="bound">i</span> <span class="main">≤</span> int <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd <span class="bound">i</span> <span class="main">=</span> <span class="inner_quoted">''''</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>nat <span class="main">(</span>fst <span class="bound">i</span><span class="main">)</span><span class="main">.</span> <span class="free">anActorID</span> <span class="main">≠</span> ACB.actorID <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> fst <span class="bound">i</span> <span class="main">≥</span> <span class="main">0</span> 
            "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>fst <span class="bound">i</span><span class="main">)</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def condition_def valid_def bind_def gets_def get_def throwError_def return_def returnOk_def
  <span class="keyword1"><span class="command">unfolding</span></span> Re_getActorNameByID_def Let_def invariant_8_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> myListIndexAux3 nat_int not_less_iff_gr_or_eq zless_nat_eq_int_zless<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
  <span class="keyword1"><span class="command">using</span></span> find_index_less_size_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">using</span></span> zless_add1_eq zless_nat_eq_int_zless <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> nth_find_index <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>


<span class="comment1">(* 
  Refinement Verification of Function updateActorPluginState_sche
*)</span>
<span class="keyword1"><span class="command">definition</span></span> scheEqualExceptReg <span class="main">::</span> <span class="quoted"><span class="quoted"><span class="language">"scheduler <span class="main">⇒</span> scheduler <span class="main">⇒</span> bool"</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">scheEqualExceptReg</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sche</span></span> <span class="main">≡</span>
         acbList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> acbList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         swarmList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> swarmList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         actorNo <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> actorNo <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> nSwarm <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheNum <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheNum <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         toPauseActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> toPauseActors <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheMsgQueue <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheMsgQueue <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         minPrioActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> minPrioActors <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         finishingActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> finishingActors <span class="free"><span class="bound">s</span></span> "</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_updateActorPluginState_sche_aux0 <span class="main">:</span> 
   <span class="quoted"><span class="quoted"><span class="language">"call <span class="main">(</span>Des_updateActorPluginStates <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> 
                   <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">i</span><span class="main">)</span><span class="main">,</span>snd <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">.</span><span class="main">(</span><span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">⦇</span>registeredBus <span class="main">:=</span> <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="free">i</span><span class="main">:=</span> fst <span class="bound">b</span><span class="main">]</span><span class="main">⦈</span><span class="main">,</span> snd <span class="bound">b</span><span class="main">)</span> <span class="main">)</span> <span class="main">=</span>
    call_spec <span class="main">(</span>Des_updateActorPluginStates <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span> <span class="main">!</span> <span class="free">i</span><span class="main">,</span> snd <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">σ</span><span class="main">⦇</span>registeredBus <span class="main">:=</span> <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">[</span><span class="free">i</span> <span class="main">:=</span> fst <span class="bound">b</span><span class="main">]</span><span class="main">⦈</span><span class="main">,</span> snd <span class="bound">b</span><span class="main">)</span><span class="main">)</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">bl</span> <span class="main">!</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bl</span><span class="main">)</span>
                 <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> snd <span class="main">(</span>Re_updateActorPluginStates <span class="main">(</span><span class="free">bl</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> <span class="main">∧</span>
                        fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_updateActorPluginStates <span class="main">(</span><span class="free">bl</span> <span class="main">!</span> <span class="free">i</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span>
                        <span class="main">∧</span> <span class="free">i</span> <span class="main">&lt;</span> length <span class="free">bl</span>  <span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> call_spec_def<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_updateActorPluginState_sche_aux1 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">" 
            length <span class="free">bl</span> <span class="main">=</span> length <span class="free">bl'</span>
        <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">bl</span><span class="main">.</span>
              <span class="free">bl'</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> fst <span class="main">(</span>Re_updateActorPluginStates <span class="main">(</span><span class="free">bl</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span><span class="main">)</span>
        <span class="main">⟹</span> <span class="free">bl'</span> <span class="main">=</span> fst <span class="main">(</span>Re_sche_updateActorPluginState0 <span class="free">bl</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span>"</span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">bl</span></span></span> <span class="quasi_keyword">arbitrary</span> <span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">anActors</span></span></span> <span class="quoted"><span class="language"><span class="free">anState</span></span></span> <span class="quoted"><span class="language"><span class="free">bl'</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>case_prod_unfold<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_length_conv Suc_mono list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> nth_Cons_0 nth_tl zero_less_Suc<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_updateActorPluginState_sche_aux2<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"
            snd <span class="main">(</span>Re_sche_updateActorPluginState0 <span class="main">(</span><span class="free">bl</span><span class="main">@</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> <span class="main">=</span> 
            <span class="main">(</span>snd <span class="main">(</span>Re_sche_updateActorPluginState0 <span class="free">bl</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>Re_updateActorPluginStates <span class="free">b</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">bl</span></span></span> <span class="quasi_keyword">arbitrary</span> <span class="main"><span class="main">:</span></span> <span class="quoted"><span class="language"><span class="free">anActors</span></span></span> <span class="quoted"><span class="language"><span class="free">anState</span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
  <span class="comment1">(* take i (registeredBus (fst s)) = fst (Re_sche_updateActorPluginState0 (take i (registeredBus sche)) anActors anState)*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_updateActorPluginState_sche <span class="main">:</span> 
   <span class="quoted"><span class="quoted"><span class="language">"Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_updateActorPluginState_sche <span class="free">anActors</span> <span class="free">anState</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> <span class="main">∧</span>
           fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_updateActorPluginState_sche_def Re_sche_updateActorPluginState_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> req_des_updateActorPluginState_sche_aux0<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> bl <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"registeredBus <span class="free">sche</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">res</span><span class="main">,</span><span class="bound">rb</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span> <span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> fst <span class="main">(</span>Re_updateActorPluginStates <span class="main">(</span>registeredBus <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span>
                <span class="bound">res</span> <span class="main">=</span> snd <span class="main">(</span>Re_sche_updateActorPluginState0 <span class="main">(</span>take <span class="bound">i</span> <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="free">anActors</span> <span class="free">anState</span> <span class="main">)</span> <span class="main">∧</span>
                scheEqualExceptReg <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="free">sche</span> <span class="main">∧</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span>
                <span class="main">∧</span> <span class="bound">rb</span> <span class="main">=</span> registeredBus <span class="free">sche</span>
                <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="bound">i</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span> length <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span> <span class="main">⟶</span> registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">=</span> registeredBus <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span> <span class="main">)</span>"</span></span></span>      
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">res</span><span class="main">,</span><span class="bound">rb</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span>length <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_4_def Bus_invariant_4_1_def 
  Bus_invariant_1_2_def Bus_invariant_2_2_def Bus_invariant_4_2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_updateActorPluginStates<span class="main">)</span></span>   
    <span class="keyword1"><span class="command">unfolding</span></span> valid_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Bus_invariant_1_2_def Bus_invariant_2_2_def Bus_invariant_4_2_def case_prodD nth_mem<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Bus_invariant_1_2_def Bus_invariant_2_2_def Bus_invariant_4_2_def case_prod_unfold fst_conv nth_mem<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Bus_invariant_1_2_def Bus_invariant_2_2_def Bus_invariant_4_2_def case_prodD fst_conv nth_mem<span class="main">)</span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_updateActorPluginStates<span class="main">)</span></span>   
    <span class="keyword1"><span class="command">unfolding</span></span> valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>case_prod_unfold<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>case_prod_unfold scheEqualExceptReg_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command">using</span></span> req_des_updateActorPluginState_sche_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prod.case_eq_if<span class="main">)</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>case_prod_unfold scheEqualExceptReg_def<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
    <span class="keyword1"><span class="command">using</span></span> scheEqualExceptReg_def <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>case_prod_unfold<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv le_refl<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv le_refl less_antisym nth_list_update_eq nth_list_update_neq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scheEqualExceptReg_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> req_des_updateActorPluginState_sche_aux2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth<span class="main">)</span></span>
  

<span class="comment1">(* 
  Refinement Verification of Function appendACBs
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> iterAppendACB_aux0<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"Re_appendACB <span class="main">(</span>Re_iterAppendACB <span class="free">sche</span> <span class="free">al</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="free">acb</span> <span class="free">anPSwarm</span>  <span class="main">=</span>
       Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span><span class="free">al</span><span class="main">@</span><span class="main">[</span><span class="free">acb</span><span class="main">]</span><span class="main">)</span> <span class="free">anPSwarm</span>  "</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="language"><span class="free">sche</span></span></span> <span class="quoted"><span class="language"><span class="free">al</span></span></span> <span class="quoted"><span class="language"><span class="free">anPSwarm</span></span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>Re_iterAppendACB.induct<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendACBs <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">⦄</span>
      Des_appendACBs <span class="free">anACBs</span> <span class="free">anPSwarm</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_appendACBs <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">∧</span>
          <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_appendACBs <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_appendACBs_def  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">t</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> length <span class="free">anACBs</span> <span class="main">∧</span>  
                 fst <span class="bound">s</span> <span class="main">=</span> Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span>take <span class="bound">t</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">anPSwarm</span> <span class="main">∧</span>
                 Re_appendACBsCheck <span class="free">anACBs</span> <span class="free">sche</span>  "</span></span></span>      
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span>length <span class="free">anACBs</span><span class="main">)</span> <span class="main">-</span> <span class="bound">t</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACBs_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">tb</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> length <span class="free">anACBs</span> <span class="main">∧</span>  <span class="bound">tb</span> <span class="main">=</span> True <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
                             Re_appendACBsCheck <span class="main">(</span>take <span class="bound">t</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">sche</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">tb</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span>length <span class="free">anACBs</span><span class="main">)</span> <span class="main">-</span> <span class="bound">t</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACBsCheck_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ib</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="free">x1</span> <span class="main">&lt;</span> length <span class="free">anACBs</span> <span class="main">∧</span>
                          <span class="bound">ib</span> <span class="main">=</span> True <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
                          Re_appendACBsCheck <span class="main">(</span>take <span class="free">x1</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">sche</span>  <span class="main">∧</span>
                          <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pl</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                               <span class="bound">bl</span> <span class="main">=</span> registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span>
                            <span class="keyword1">in</span> Re_appendACBsCheck1 <span class="bound">pl</span> <span class="bound">bl</span><span class="main">)</span>"</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">ib</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">j</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="free">x1</span> <span class="main">&lt;</span> length <span class="free">anACBs</span> <span class="main">∧</span>
                     <span class="free">x1a</span> <span class="main">&lt;</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                     Re_appendACBsCheck <span class="main">(</span>take <span class="free">x1</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">sche</span>  <span class="main">∧</span>
                     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pl</span> <span class="main">=</span> take <span class="free">x1a</span> <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="keyword1">in</span> Re_appendACBsCheck1 <span class="bound">pl</span> <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">bl</span> <span class="main">=</span> take <span class="bound">j</span> <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                          <span class="bound">p</span> <span class="main">=</span> plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="free">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="free">x1a</span>
                       <span class="keyword1">in</span> <span class="main">¬</span><span class="main">(</span>Re_appendACBsCheck0 <span class="bound">p</span> <span class="bound">bl</span><span class="main">)</span> <span class="main">)</span>  "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">j</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
  <span class="keyword1"><span class="command">using</span></span> Re_appendACBsCheck0_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def returnOk_def throwError_def 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_appendACBsCheck_def find_None_iff insertE take_insert_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACBsCheck1_def<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 4 
  <span class="keyword1"><span class="command">unfolding</span></span> Re_appendACBs_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_appendACBsCheck1_def Re_appendACBsCheck_def find_None_iff nth_mem<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 3
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_appendACBsCheck1_def Re_appendACBsCheck_def find_None_iff nth_mem<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_appendACBsCheck1_def Let_def getBusName_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_appendACBsCheck0 <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="main">(</span><span class="free">anACBs</span> <span class="main">!</span> <span class="improper">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="improper">x1a</span><span class="main">)</span> <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> find_None_iff insertE take_insert_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACBsCheck0_def getBusName_def<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">meson</span> find_None_iff in_set_conv_nth option.exhaust<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACBsCheck0_def getBusName_def<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> find_None_iff insertE option.discI take_insert_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span>take <span class="main">(</span>Suc <span class="improper">r</span><span class="main">)</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">anPSwarm</span> <span class="main">=</span> 
            Re_appendACB <span class="main">(</span>Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span>take <span class="improper">r</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">(</span><span class="free">anACBs</span><span class="main">!</span><span class="improper">r</span><span class="main">)</span> <span class="free">anPSwarm</span>  "</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_appendACB_def Let_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_appendACB <span class="main">(</span>Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span>take <span class="improper">r</span> <span class="free">anACBs</span><span class="main">)</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">(</span><span class="free">anACBs</span><span class="main">!</span><span class="improper">r</span><span class="main">)</span> <span class="free">anPSwarm</span>  <span class="main">=</span>
            Re_iterAppendACB <span class="free">sche</span> <span class="main">(</span><span class="main">(</span>take <span class="improper">r</span> <span class="free">anACBs</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="main">(</span><span class="free">anACBs</span><span class="main">!</span><span class="improper">r</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="free">anPSwarm</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> iterAppendACB_aux0 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="comment1">(* 
  Refinement Verification of Function appendSwarmACBs
*)</span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">appendSwarmACBs_scheAux1</span> <span class="free"><span class="bound">sche</span></span> <span class="free"><span class="bound">anACBs</span></span> <span class="free"><span class="bound">anPSwarm</span></span> <span class="main">≡</span>
               <span class="main">(</span>Re_appendACBs
                   <span class="main">(</span><span class="free"><span class="bound">sche</span></span> <span class="main">⦇</span>swarmList <span class="main">:=</span> swarmList <span class="free"><span class="bound">sche</span></span> <span class="main">@</span>
                          <span class="main">[</span><span class="free"><span class="bound">anPSwarm</span></span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                          nSwarm <span class="main">:=</span> nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">)</span>
                    <span class="free"><span class="bound">anACBs</span></span>
                   <span class="main">(</span><span class="free"><span class="bound">anPSwarm</span></span> <span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux1 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⟦</span> <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span><span class="main">⦄</span> <span class="free">a</span> <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⦄</span><span class="main">;</span> <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⦄</span> <span class="free">a</span> <span class="main">⦃</span> <span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">R</span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⦄</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⦄</span> <span class="free">a</span> <span class="main">⦃</span> <span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">r</span> <span class="bound">s</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> hoare_post_comb_imp_conj <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux2<span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
      <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">xb</span> <span class="main">=</span> <span class="main">(</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span>
        fst <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">sche</span> <span class="main">⦇</span>swarmList <span class="main">:=</span> swarmList <span class="free">sche</span> <span class="main">@</span> <span class="main">[</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                      nSwarm <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">)</span>
       <span class="main">⦄</span> 
       Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span>
              <span class="main">⦇</span>scheMsgQueue <span class="main">:=</span>
                 push_que <span class="main">(</span>scheMsgQueue <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>nullScheduleMsg
                   <span class="main">⦇</span>ScheduleMsg.type <span class="main">:=</span> ScheduleMsgType.SCHEDULE_CMD_RAW<span class="main">,</span> param1 <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> param2 <span class="main">:=</span> <span class="main">0</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span> <span class="main">=</span>
              fst <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span>
              <span class="main">⦇</span>scheMsgQueue <span class="main">:=</span>
                 push_que
                  <span class="main">(</span>scheMsgQueue <span class="main">(</span>fst <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">⦇</span>ScheduleMsg.type <span class="main">=</span> ScheduleMsgType.SCHEDULE_CMD_RAW<span class="main">,</span> param1 <span class="main">=</span> <span class="main">0</span><span class="main">,</span> param2 <span class="main">=</span> <span class="main">0</span><span class="main">,</span>
                     param3 <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">⦈</span>
       <span class="main">⦄</span> 
  "</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_appendACBs<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> ScheduleMsg.update_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ScheduleMsg.update_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ScheduleMsg.update_convs<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> case_prod_unfold nullScheduleMsg_def scheduler.unfold_congs<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux3<span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
      <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">xb</span> <span class="main">=</span> <span class="main">(</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span>
        fst <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">sche</span> <span class="main">⦇</span>swarmList <span class="main">:=</span> swarmList <span class="free">sche</span> <span class="main">@</span> <span class="main">[</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                      nSwarm <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">)</span>
       <span class="main">⦄</span> 
       Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span><span class="main">0</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_appendACBs<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux4 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">tx</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> SWARM_MAX_SIZE <span class="main">⟹</span>
       snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
       <span class="main">¬</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> SWARM_MAX_SIZE <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">tx</span> <span class="main">=</span> nSwarm <span class="free">sche</span> <span class="main">⦄</span> Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span>
              <span class="main">⦇</span>scheMsgQueue <span class="main">:=</span>
                 push_que <span class="main">(</span>scheMsgQueue <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>nullScheduleMsg
                   <span class="main">⦇</span>ScheduleMsg.type <span class="main">:=</span> ScheduleMsgType.SCHEDULE_CMD_RAW<span class="main">,</span> param1 <span class="main">:=</span> <span class="main">0</span><span class="main">,</span>
                      param2 <span class="main">:=</span> <span class="main">0</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span> <span class="main">=</span>
              <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux5<span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
      <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">xb</span> <span class="main">=</span> <span class="main">(</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span>
        fst <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">sche</span> <span class="main">⦇</span>swarmList <span class="main">:=</span> swarmList <span class="free">sche</span> <span class="main">@</span> <span class="main">[</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                      nSwarm <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">)</span>
       <span class="main">⦄</span> 
       Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span>
              <span class="main">⦇</span>swarmList <span class="main">:=</span>
                 swarmList <span class="free">sche</span> <span class="main">@</span>
                 <span class="main">[</span><span class="free">anPSwarm</span>
                  <span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                 nSwarm <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_appendACBs<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_appendACBs_def case_prodD <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux6<span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
      <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">xb</span> <span class="main">=</span> <span class="main">(</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span>
        fst <span class="bound">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">sche</span> <span class="main">⦇</span>swarmList <span class="main">:=</span> swarmList <span class="free">sche</span> <span class="main">@</span> <span class="main">[</span><span class="free">anPSwarm</span><span class="main">⦇</span>swarmID <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">,</span> SwarmInfo.state <span class="main">:=</span> actorState.ACTOR_STATE_INIT<span class="main">⦈</span><span class="main">]</span><span class="main">,</span>
                      nSwarm <span class="main">:=</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span><span class="main">⦈</span><span class="main">)</span>
       <span class="main">⦄</span> 
       Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≠</span><span class="main">0</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_appendACBs<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_unfold<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs_aux7 <span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">tx</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> SWARM_MAX_SIZE <span class="main">⟹</span>
       snd <span class="main">(</span>appendSwarmACBs_scheAux1 <span class="free">sche</span> <span class="free">anACBs</span> <span class="free">anPSwarm</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
       <span class="main">¬</span> nSwarm <span class="free">sche</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> SWARM_MAX_SIZE <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">tx</span> <span class="main">=</span> nSwarm <span class="free">sche</span> <span class="main">⦄</span>
       Des_appendACBs <span class="free">anACBs</span> <span class="free">xb</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span>
              <span class="main">⦇</span>scheMsgQueue <span class="main">:=</span>
                 push_que <span class="main">(</span>scheMsgQueue <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>nullScheduleMsg
                   <span class="main">⦇</span>ScheduleMsg.type <span class="main">:=</span> ScheduleMsgType.SCHEDULE_CMD_RAW<span class="main">,</span> param1 <span class="main">:=</span> <span class="main">0</span><span class="main">,</span>
                      param2 <span class="main">:=</span> <span class="main">0</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span> <span class="main">=</span>
              <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_appendSwarmACBs <span class="main">:</span> 
   <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_appendSwarmACBs <span class="free">anPSwarm</span> <span class="free">anACBs</span> 
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_appendSwarmACBs <span class="free">sche</span> <span class="free">anPSwarm</span> <span class="free">anACBs</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_appendSwarmACBs_def Des_appendScheduleMsg_def  Re_appendSwarmACBs_def Let_def 
            Re_appendScheduleMsg_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> req_des_appendSwarmACBs_aux3
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux4<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux4<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux5<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> req_des_appendSwarmACBs_aux6
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux7<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span> req_des_appendSwarmACBs_aux7<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(* 
  Refinement Verification of Function getSwarm
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_getSwarm <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_getSwarm <span class="free">anSwarmName</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
          Re_getSwarm <span class="free">sche</span> <span class="free">anSwarmName</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_getSwarm_def invariant_2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
    <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> int <span class="main">(</span>fst <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="bound">i</span> <span class="main">=</span> nullSwarmInfo <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>fst <span class="bound">i</span><span class="main">.</span> <span class="free">anSwarmName</span> <span class="main">≠</span> swarmName <span class="main">(</span>swarmList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>
            "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> nat <span class="main">(</span>nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>fst <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def condition_def valid_def bind_def gets_def get_def throwError_def return_def returnOk_def
  <span class="keyword1"><span class="command">unfolding</span></span> Re_getSwarm_def Let_def Re_getS_swarm_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> myListIndexAux3 nat_neq_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> find_index_less_size_conv nth_mem of_nat_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> nat_int nth_find_index<span class="main">)</span></span>



<span class="comment1">(* 
  Refinement Verification of Function checkActorPluginFinished
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_checkActorPluginFinished_aux0 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" call <span class="main">(</span>Des_getActorPluginState <span class="main">(</span>PluginInfo.name <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">(</span>ACB.actorID <span class="free">anItr</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">ra</span><span class="main">,</span> snd <span class="bound">σ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">=</span>
    call_spec <span class="main">(</span>Des_getActorPluginState 
        <span class="main">(</span>PluginInfo.name <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ACB.actorID <span class="free">anItr</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">σ</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">ra</span><span class="main">,</span> snd <span class="bound">σ</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">σ</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">σ</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">bl</span> <span class="main">!</span> <span class="free">ra</span> <span class="main">∧</span> <span class="free">ra</span> <span class="main">&lt;</span> length <span class="free">bl</span><span class="main">)</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> Re_getActorPluginState <span class="main">(</span><span class="free">bl</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">(</span>PluginInfo.name <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">(</span>ACB.actorID <span class="free">anItr</span><span class="main">)</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">bl</span> <span class="main">!</span> <span class="free">ra</span> <span class="main">∧</span> <span class="free">ra</span> <span class="main">&lt;</span> length <span class="free">bl</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> call_spec_def<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_checkActorPluginFinished<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
   Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_checkActorPluginFinished <span class="free">anItr</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
          <span class="bound">r</span> <span class="main">=</span>  Re_checkActorPluginFinished <span class="free">sche</span> <span class="free">anItr</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_checkActorPluginFinished_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
    <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> 
                    <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pil</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                         <span class="bound">bl</span> <span class="main">=</span> registeredBus <span class="free">sche</span>
                      <span class="keyword1">in</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">pi</span><span class="main">.</span> Re_checkActorPluginFinished0 
                           <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span> <span class="bound">pi</span> <span class="free">anItr</span><span class="main">)</span> <span class="bound">pil</span> <span class="main">=</span> length <span class="bound">pil</span> <span class="main">)</span>
            "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_checkActorPluginFinished_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> req_des_checkActorPluginFinished_aux0<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> bl <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"registeredBus <span class="free">sche</span>"</span></span></span></span>  <span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">j</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">j</span> <span class="main">≤</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> 
                     <span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">pil</span> <span class="main">=</span> take <span class="free">r</span> <span class="main">(</span>plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                           <span class="bound">bl</span> <span class="main">=</span> registeredBus <span class="free">sche</span>
                       <span class="keyword1">in</span> find_index <span class="main">(</span><span class="main">λ</span><span class="bound">pi</span><span class="main">.</span> Re_checkActorPluginFinished0 
                            <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span> <span class="bound">pi</span> <span class="free">anItr</span><span class="main">)</span> <span class="bound">pil</span> <span class="main">=</span> length <span class="bound">pil</span> <span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span><span class="keyword1">let</span> <span class="bound">bl'</span> <span class="main">=</span> take <span class="bound">j</span> <span class="main">(</span>registeredBus <span class="free">sche</span><span class="main">)</span><span class="main">;</span>
                          <span class="bound">pi</span> <span class="main">=</span> plugins <span class="main">(</span>ACB.taskInfo <span class="free">anItr</span><span class="main">)</span> <span class="main">!</span> <span class="free">r</span>
                       <span class="keyword1">in</span> <span class="main">¬</span> <span class="main">(</span> Re_checkActorPluginFinished0 <span class="bound">bl'</span> <span class="bound">pi</span> <span class="free">anItr</span><span class="main">)</span> <span class="main">)</span> "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>registeredBus <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">j</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> returnOk_def throwError_def validE_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> validE_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Re_checkActorPluginFinished0_def find_index_less_size_conv insertE less_not_refl3 myListIndexAux3 take_insert_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_checkActorPluginFinished0_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> find_index_less_size_conv getBusName_def insertE less_not_refl3 myListIndexAux3 take_insert_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> index_take_min_aux0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span> 
   <span class="keyword1"><span class="command">using</span></span> Re_checkActorPluginFinished0_def length_ineq_not_Nil<span class="main">(</span>1<span class="main">)</span> myListIndexAux3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Re_checkActorPluginFinished_def<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_checkActorPluginFinished0_def getBusName_def myListIndexAux1<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_getActorPluginState<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def
             Bus_invariant_5_def Bus_invariant_4_1_def Bus_invariant_5_1_def Bus_invariant_1_2_def
             Bus_invariant_2_2_def Bus_invariant_3_2_def Bus_invariant_4_2_def Bus_invariant_5_2_def
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command">using</span></span> nth_mem  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>


<span class="comment1">(* 
  Refinement Verification of Function findFinishActors
*)</span>
<span class="keyword1"><span class="command">definition</span></span> scheEqualExceptFinList <span class="main">::</span> <span class="quoted"><span class="quoted"><span class="language">"scheduler <span class="main">⇒</span> scheduler <span class="main">⇒</span> bool"</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">scheEqualExceptFinList</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sche</span></span> <span class="main">≡</span>
         acbList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> acbList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         swarmList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> swarmList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         actorNo <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> actorNo <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> nSwarm <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheNum <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheNum <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         registeredBus <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> registeredBus <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheMsgQueue <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheMsgQueue <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         toPauseActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> toPauseActors <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         minPrioActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> minPrioActors <span class="free"><span class="bound">s</span></span>"</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findFinishActors_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
          finishingActors <span class="free">sche</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>
          Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
          Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
           <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="bound">r</span><span class="main">)</span> <span class="main">∧</span>
                length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>  <span class="bound">r</span> <span class="main">∧</span>
                <span class="bound">r</span> <span class="main">&lt;</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                scheEqualExceptFinList <span class="free">sche</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span>
                map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span> state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span>
                           taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>
                <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_INIT <span class="main">∧</span> Re_checkActorPluginFinished <span class="free">sche</span> <span class="bound">a</span><span class="main">)</span>
                  <span class="main">(</span>take <span class="bound">r</span> <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦄</span> 
                  Des_checkActorPluginFinished <span class="bound">x</span> 
           <span class="main">⦃</span><span class="main">λ</span><span class="bound">xa</span> <span class="bound">s</span><span class="main">.</span>
               ACB.state <span class="bound">x</span> <span class="main">=</span> actorState.ACTOR_STATE_INIT <span class="main">⟶</span>
               length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="bound">r</span> <span class="main">∧</span>
               Suc <span class="bound">r</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               scheEqualExceptFinList <span class="free">sche</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
               finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span>
               map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span> state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span>
                           taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>
                <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_INIT <span class="main">∧</span> Re_checkActorPluginFinished <span class="free">sche</span> <span class="bound">a</span><span class="main">)</span>
                  <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_checkActorPluginFinished<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def case_prodD fst_conv scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 case_prodD fst_conv take_filter_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findFinishActors <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">∧</span> finishingActors <span class="free">sche</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>
   Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
   Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_findFinishActors
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_findFinishActors <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_findFinishActors_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>scheEqualExceptFinList <span class="free">sche</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> 
                       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">al</span> <span class="main">=</span> take <span class="bound">i</span>  <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                            <span class="bound">al'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_INIT <span class="main">∧</span> 
                                    Re_checkActorPluginFinished <span class="free">sche</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">al</span><span class="main">;</span>
                            <span class="bound">al''</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID   <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.state     <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.taskInfo  <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span> <span class="bound">al'</span>
                         <span class="keyword1">in</span> <span class="bound">al''</span>    <span class="main">)</span>    <span class="main">)</span>
                   "</span></span></span>  
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Re_findFinishActors_def Let_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>      
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_findFinishActors_aux0<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r x 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_checkActorPluginFinished<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>valid_def<span class="main">)</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def case_prodD fst_conv scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="main">(</span>Re_checkActorPluginFinished <span class="free">sche</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 case_prodD fst_conv take_filter_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">¬</span> <span class="main">(</span>Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_checkActorPluginFinished_def scheEqualExceptFinList_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_checkActorPluginFinished<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>valid_def<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_leI case_prod_conv fst_conv length_map less_or_eq_imp_le not_less_eq not_less_eq_eq<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"scheEqualExceptFinList <span class="free">sche</span> <span class="improper">ab</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> scheEqualExceptFinList_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">a</span> <span class="main">=</span> <span class="improper">ab</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> scheEqualExceptFinList_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_checkActorPluginFinished <span class="free">sche</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">a</span> <span class="main">=</span> <span class="improper">ab</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  take_Suc_conv_app_nth<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_checkActorPluginFinished_def scheEqualExceptFinList_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>fst <span class="main">(</span>Des_checkActorPluginFinished <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span> <span class="main">(</span><span class="improper">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ret</span><span class="main">,</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">⇒</span> fst <span class="bound">s'</span> <span class="main">=</span> <span class="improper">a</span> <span class="main">∧</span> <span class="bound">ret</span> <span class="main">=</span> Re_checkActorPluginFinished <span class="improper">a</span> <span class="main">(</span>acbList <span class="improper">a</span> <span class="main">!</span> <span class="improper">r</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bus_invariant_1_def Bus_invariant_2_def Bus_invariant_3_def Bus_invariant_4_def Bus_invariant_5_def scheEqualExceptFinList_def<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function delFinishActors
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_delFinishActors_aux0 <span class="main">:</span> 
    <span class="quoted"><span class="quoted"><span class="language">" <span class="free">a</span> <span class="main">=</span> <span class="free">xt</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⟹</span>
      <span class="main">(</span>remove1 <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
        filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>ActorPluginInfo.actorID <span class="main">(</span>finishingActors <span class="free">a</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>
          <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="free">a</span><span class="main">⦇</span>acbList <span class="main">:=</span> remove1 <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span><span class="main">⦈</span> <span class="main">=</span> 
        <span class="free">xt</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> set 
          <span class="main">(</span>take <span class="main">(</span>Suc <span class="free">r</span><span class="main">)</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> "</span></span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="language"><span class="operator">-</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"remove1 <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>ActorPluginInfo.actorID <span class="main">(</span>finishingActors <span class="free">a</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span>"</span></span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">a</span> <span class="main">=</span> <span class="free">xt</span> <span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span><span class="main">⦈</span>"</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted"><span class="language">"filter <span class="main">(</span><span class="main">λ</span><span class="bound">aa</span><span class="main">.</span> ACB.actorID <span class="bound">aa</span> <span class="main">∉</span> ActorPluginInfo.actorID <span class="main">`</span> insert <span class="main">(</span>finishingActors <span class="free">a</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">xt</span><span class="main">)</span> <span class="main">=</span> remove1 <span class="main">(</span>acbList <span class="free">a</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">(</span>acbList <span class="free">a</span><span class="main">)</span>"</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="language"><span class="var">?thesis</span></span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a3 a2 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> record_acbList_aux0 take_insert_nth<span class="main">)</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_delFinishActors_aux2<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"
   Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="keyword1">let</span> <span class="main">(</span><span class="bound">aa</span><span class="main">,</span> <span class="bound">True</span><span class="main">)</span> <span class="main">=</span> Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH
        <span class="keyword1">in</span> finishingActors <span class="bound">aa</span> <span class="main">=</span> finishingActors <span class="free">sche</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Re_sche_updateActorPluginState_def case_prod_unfold Let_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> req_des_delFinishActors_aux1<span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">"Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
        <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free">fal</span> <span class="main">=</span> finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> 
            Des_updateActorPluginState_sche <span class="free">fal</span> actorState.ACTOR_STATE_FINISH 
        <span class="main">⦃</span><span class="main">λ</span><span class="bound">flag</span> <span class="bound">s</span><span class="main">.</span>
             <span class="main">(</span><span class="bound">flag</span> <span class="main">⟶</span>
                <span class="main">0</span> <span class="main">≤</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                <span class="free">fal</span> <span class="main">=</span> finishingActors <span class="free">sche</span> <span class="main">∧</span>
                finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">fal</span> <span class="main">∧</span>
                invariant_8 <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fal'</span> <span class="main">=</span> take <span class="main">0</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span><span class="main">;</span> <span class="bound">a</span> <span class="main">=</span> Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH
                 <span class="keyword1">in</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span>
                    <span class="main">(</span><span class="bound">sche'</span><span class="main">,</span> <span class="bound">flag'</span><span class="main">)</span> <span class="main">⇒</span>
                      <span class="bound">flag'</span> <span class="main">=</span> True <span class="main">∧</span>
                      invariant_8 <span class="bound">sche'</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche'</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> set <span class="main">(</span>map ActorPluginInfo.actorID <span class="bound">fal'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="bound">sche'</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">¬</span> <span class="bound">flag</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> Re_delFinishActors <span class="free">sche</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold Re_delFinishActors_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_updateActorPluginState_sche<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH <span class="main">=</span> <span class="main">(</span><span class="improper">aa</span><span class="main">,</span>True<span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> req_des_delFinishActors_aux2   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> prod.collapse prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH <span class="main">=</span> <span class="main">(</span><span class="improper">aa</span><span class="main">,</span>True<span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_sche_updateActorPluginState_inv8 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> prod.collapse prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH <span class="main">=</span> <span class="main">(</span><span class="improper">aa</span><span class="main">,</span>True<span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> prod.collapse prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_sche_updateActorPluginState_inv8 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">metis</span></span> 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH <span class="main">=</span> <span class="main">(</span><span class="improper">aa</span><span class="main">,</span>True<span class="main">)</span>"</span></span></span><span class="main">)</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> prod.collapse prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_delFinishActors <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_delFinishActors
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_delFinishActors <span class="free">sche</span><span class="main">⦄</span>
"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_delFinishActors_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span>  <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                      <span class="free">fal</span> <span class="main">=</span> finishingActors <span class="free">sche</span> <span class="main">∧</span> finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">=</span> <span class="free">fal</span> <span class="main">∧</span> 
                      invariant_8 <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fal'</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span><span class="main">;</span> 
                           <span class="main">(</span><span class="bound">sche'</span><span class="main">,</span><span class="bound">flag'</span><span class="main">)</span> <span class="main">=</span> Re_sche_updateActorPluginState <span class="free">sche</span> 
                                <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH
                        <span class="keyword1">in</span> <span class="bound">flag'</span> <span class="main">=</span> True <span class="main">∧</span> invariant_8 <span class="main">(</span><span class="bound">sche'</span><span class="main">)</span> <span class="main">∧</span>
                           fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche'</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> set <span class="main">(</span>map 
                                <span class="main">(</span><span class="main">λ</span><span class="bound">api</span><span class="main">.</span> ActorPluginInfo.actorID <span class="bound">api</span><span class="main">)</span> <span class="bound">fal'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="bound">sche'</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>
                       "</span></span></span>  
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span> finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">j</span> <span class="bound">s</span><span class="main">.</span>  <span class="bound">j</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                      <span class="free">fal</span> <span class="main">=</span> finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> finishingActors <span class="free">sche</span> <span class="main">=</span> <span class="free">fal</span> <span class="main">∧</span>
                      invariant_8 <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="keyword1">let</span> <span class="bound">fal'</span> <span class="main">=</span> take <span class="free">r</span> <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span><span class="main">;</span>
                            <span class="main">(</span><span class="bound">sche'</span><span class="main">,</span><span class="bound">flag'</span><span class="main">)</span> <span class="main">=</span> Re_sche_updateActorPluginState <span class="free">sche</span> 
                                <span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_FINISH
                        <span class="keyword1">in</span> <span class="bound">flag'</span> <span class="main">=</span> True <span class="main">∧</span> invariant_8 <span class="bound">sche'</span> <span class="main">∧</span>
                           fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche'</span><span class="main">⦇</span>acbList <span class="main">:=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.actorID <span class="bound">a</span> <span class="main">∉</span> set <span class="main">(</span>map 
                                <span class="main">(</span><span class="main">λ</span><span class="bound">api</span><span class="main">.</span> ActorPluginInfo.actorID <span class="bound">api</span><span class="main">)</span> <span class="bound">fal'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>acbList <span class="bound">sche'</span><span class="main">)</span><span class="main">⦈</span> <span class="main">)</span> <span class="main">∧</span>
                       <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">t</span></span><span class="main">&lt;</span><span class="bound">j</span><span class="main">.</span>  ACB.actorID <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">!</span><span class="bound">t</span><span class="main">)</span> <span class="main">≠</span> 
                               ActorPluginInfo.actorID <span class="main">(</span><span class="main">(</span>finishingActors <span class="free">sche</span><span class="main">)</span> <span class="main">!</span> <span class="free">r</span><span class="main">)</span> <span class="main">)</span>
                       "</span></span></span>  
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">j</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span> acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">j</span>"</span></span></span></span><span class="main"><span class="main">]</span></span>  <span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> returnOk_def throwError_def validE_def
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_delFinishActors_aux1<span class="main">)</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command">using</span></span> less_Suc_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> flag r a flag' x y
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> filter_set_notin_aux2
            <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="skolem">r</span> <span class="main">(</span>finishingActors <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
               <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> a <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">a</span>"</span></span></span>
               <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> faID <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"ActorPluginInfo.actorID <span class="main">(</span><span class="main">(</span>finishingActors <span class="skolem">a</span><span class="main">)</span><span class="main">!</span><span class="skolem">r</span><span class="main">)</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invariant_8_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_set_ACB_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_delFinishActors_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> invariant_8_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> flag r ra a x y
  <span class="keyword1"><span class="command">using</span></span> distinct_map_remove1_aux<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>acbList <span class="skolem">a</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> ra <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">ra</span>"</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> flag r ra a x y
  <span class="keyword1"><span class="command">using</span></span> req_des_delFinishActors_aux0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> remove1_filter_aux1<span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="skolem">a</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> ra <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">ra</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> xl <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span>acbList <span class="skolem">x</span><span class="main">)</span>"</span></span></span>
                  <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> A <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="language">"ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="skolem">r</span> <span class="main">(</span>finishingActors <span class="skolem">a</span><span class="main">)</span><span class="main">)</span>"</span></span></span>
                  <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> faID <span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"ActorPluginInfo.actorID <span class="main">(</span><span class="main">(</span>finishingActors <span class="skolem">a</span><span class="main">)</span><span class="main">!</span><span class="skolem">r</span><span class="main">)</span>"</span></span></span></span> <span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> record_acbList_aux1 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(* 
  Refinement Verification of Function findMinPrioSwarm
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findMinPrioSwarm <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"   invariant_2 <span class="free">sche</span>
    <span class="main">∧</span> invariant_12 <span class="free">sche</span>
    <span class="main">∧</span> invariant_18 <span class="free">sche</span>
    <span class="main">∧</span> <span class="free">minSwarmPtr</span> <span class="main">=</span> None 
    <span class="main">∧</span> <span class="free">minSwarmPrio</span> <span class="main">=</span> MAX_PRIORITY<span class="main">+</span><span class="main">1</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
     Des_findMinPrioSwarm <span class="free">minSwarmPtr</span> <span class="free">minSwarmPrio</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> fst <span class="bound">r</span> <span class="main">=</span> fst <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="free">minSwarmPrio</span><span class="main">)</span>
          <span class="main">∧</span> snd <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="free">minSwarmPrio</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> Des_findMinPrioSwarm_def invariant_2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">msPtr</span><span class="main">,</span><span class="bound">msPrio</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> int <span class="bound">i</span> <span class="main">≤</span> nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span> <span class="bound">i</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">msPtr</span> <span class="main">=</span> None <span class="main">∧</span> <span class="bound">msPrio</span> <span class="main">=</span> MAX_PRIORITY<span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span> <span class="bound">i</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟶</span> <span class="bound">msPtr</span> <span class="main">≠</span> None <span class="main">∧</span> index <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>the <span class="bound">msPtr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">i</span>  <span class="main">∧</span> swarmPrio <span class="main">(</span>the <span class="bound">msPtr</span><span class="main">)</span> <span class="main">=</span> <span class="bound">msPrio</span> <span class="main">∧</span> <span class="bound">msPrio</span> <span class="main">&lt;</span> <span class="main">(</span>MAX_PRIORITY<span class="main">+</span><span class="main">1</span><span class="main">)</span> 
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span> index <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>the <span class="bound">msPtr</span><span class="main">)</span><span class="main">.</span> <span class="bound">msPrio</span> <span class="main">&lt;</span> swarmPrio <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="bound">msPrio</span> <span class="main">≤</span> swarmPrio <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">)</span>
                        
                  "</span></span></span> 
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">msPtr</span><span class="main">,</span><span class="bound">msPrio</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> nat <span class="main">(</span>nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_findMinPrioSwarm_def Let_def invariant_12_def invariant_18_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> distinct_map index_nth_id less_not_refl3 not_less_eq of_nat_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> distinct_map index_nth_id of_nat_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> less_antisym<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> less_antisym<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> distinct_map index_nth_id of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> distinct_map index_nth_id not_less_zero of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> nth_mem of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> nth_mem of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> nth_mem of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> nth_mem of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> nth_mem of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> index_less_size_conv nth_index index_find_aux find_cong nat_int.Rep_eqD<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> find_Some_iff index_less_size_conv nat_int.Rep_eqD<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> find.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> length_greater_0_conv of_nat_0_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> option.discI <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> index_less_size_conv nth_index index_find_aux find_cong nat_int.Rep_eqD<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function ifMinPrioSwarmHaveActor
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_ifMinPrioSwarmHaveActor <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" <span class="free">minIdx</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> 
    <span class="main">∧</span> <span class="free">minPrio</span> <span class="main">=</span> MAX_PRIORITY<span class="main">+</span><span class="main">1</span>
    <span class="main">∧</span> invariant_12 <span class="free">sche</span>
    <span class="main">∧</span> invariant_17 <span class="free">sche</span>  <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_ifMinPrioSwarmHaveActor <span class="free">minSwarmPtr</span> <span class="free">minIdx</span> <span class="free">minPrio</span> 
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">=</span> ifMinPrioSwarmHaveActor <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="free">minSwarmPtr</span> <span class="free">minPrio</span> <span class="free">minIdx</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_ifMinPrioSwarmHaveActor_def ifMinPrioSwarmHaveActor_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">idx</span><span class="main">,</span><span class="bound">prio</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span>  fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>
                  <span class="main">(</span> <span class="bound">idx</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟶</span> <span class="bound">prio</span> <span class="main">=</span> MAX_PRIORITY <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span> 
                            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span><span class="main">)</span>    <span class="main">)</span> <span class="main">∧</span> 
                  <span class="main">(</span> <span class="bound">idx</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span> <span class="main">⟶</span> <span class="bound">prio</span> <span class="main">&lt;</span> MAX_PRIORITY <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>  <span class="bound">idx</span> <span class="main">&lt;</span> int <span class="bound">i</span> <span class="main">∧</span> <span class="bound">idx</span> <span class="main">≥</span> <span class="main">(</span>int <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
                             <span class="bound">prio</span> <span class="main">=</span> ACB.prio <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="bound">idx</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                             swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="main">(</span>nat <span class="bound">idx</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="main">(</span>nat <span class="bound">idx</span><span class="main">)</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∨</span>
                                ACB.prio <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">&gt;</span> <span class="bound">prio</span><span class="main">)</span> <span class="main">∧</span>
                            <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∨</span>
                                ACB.prio <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">≥</span> <span class="bound">prio</span> <span class="main">)</span>
                   <span class="main">)</span>
                 <span class="main">)</span>"</span></span></span> 
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">idx</span><span class="main">,</span><span class="bound">prio</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def invariant_12_def invariant_17_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> less_antisym<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> less_antisym<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> index_find_aux1<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span>
       prio <span class="bound">a</span> <span class="main">≤</span> MAX_PRIORITY <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">.</span>
                                    swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span>
                                    prio <span class="bound">a</span> <span class="main">≤</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_less_iff not_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_less_iff nth_mem <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> index_find_aux2<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span>
       prio <span class="bound">a</span> <span class="main">≤</span> MAX_PRIORITY <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">.</span>
                                    swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span>
                                    prio <span class="bound">a</span> <span class="main">≤</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_less_iff not_le <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> nat_less_iff nth_mem <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> aa
    <span class="keyword1"><span class="command">using</span></span> index_find_aux3<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">aa</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span>
          prio <span class="bound">a</span> <span class="main">≤</span> MAX_PRIORITY <span class="main">∧</span>  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span><span class="main">.</span>
                                      swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span>
                                      prio <span class="bound">a</span> <span class="main">≤</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_less_iff not_less <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command">using</span></span> nat_less_iff nth_mem <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> find_None_iff index_less_size_conv nth_index<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function findActorUnderMinSwarm
*)</span>
<span class="keyword1"><span class="command">definition</span></span> scheEqualExceptMinList <span class="main">::</span> <span class="quoted"><span class="quoted"><span class="language">"scheduler <span class="main">⇒</span> scheduler <span class="main">⇒</span> bool"</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">scheEqualExceptMinList</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sche</span></span> <span class="main">≡</span>
         acbList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> acbList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         swarmList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> swarmList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         actorNo <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> actorNo <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> nSwarm <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheNum <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheNum <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         registeredBus <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> registeredBus <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheMsgQueue <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheMsgQueue <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         toPauseActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> toPauseActors <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         finishingActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> finishingActors <span class="free"><span class="bound">s</span></span> "</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findActorUnderMinSwarm<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">∧</span> minPrioActors <span class="free">sche</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span>  <span class="main">⦄</span>
      Des_findActorUnderMinSwarm <span class="free">minSwarmPtr</span> <span class="free">minPrio</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="free">sche</span> <span class="free">minSwarmPtr</span> <span class="free">minPrio</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_findActorUnderMinSwarm_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> length <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>scheEqualExceptMinList <span class="free">sche</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                <span class="main">(</span> <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> 
                      ACB.state <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∨</span>
                      swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∨</span>
                      ACB.prio <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> <span class="free">minPrio</span> <span class="main">)</span>   <span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> 
                      <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">al</span> <span class="main">=</span> take <span class="bound">i</span>  <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                            <span class="bound">al'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING 
                                    <span class="main">∧</span> swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> 
                                    <span class="main">∧</span> ACB.prio <span class="bound">a</span> <span class="main">=</span> <span class="free">minPrio</span><span class="main">)</span> <span class="bound">al</span><span class="main">;</span>
                            <span class="bound">al''</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID   <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.state     <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.taskInfo  <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span> <span class="bound">al'</span>
                         <span class="keyword1">in</span> <span class="bound">al''</span>    <span class="main">)</span>  <span class="main">)</span>   <span class="main">)</span>
                   "</span></span></span>  
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>  <span class="keyword1"><span class="command">unfolding</span></span>  scheEqualExceptMinList_def 
  <span class="keyword1"><span class="command">unfolding</span></span> Re_findAcotorUnderMinSwarm_def Let_def invariant_8_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                  swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span> prio <span class="bound">a</span> <span class="main">=</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux2<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                  swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span> prio <span class="bound">a</span> <span class="main">=</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_filter_aux3<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                  swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span> prio <span class="bound">a</span> <span class="main">=</span> prio <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span></span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> filter_False index_less_size_conv length_greater_0_conv length_map nth_index old.unit.exhaust scheduler.surjective scheduler.update_convs<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function findRunningSwarm
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findRunningSwarm <span class="main">:</span> 
   <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="free">sche</span>
    <span class="main">∧</span> <span class="free">runningSwarmPtr</span> <span class="main">=</span> None 
    <span class="main">∧</span> <span class="free">nRunningSwarm</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span>
     <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
        Des_findRunningSwarm <span class="free">runningSwarmPtr</span> <span class="free">nRunningSwarm</span>
     <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>  <span class="bound">r</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="free">nRunningSwarm</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_findRunningSwarm_def invariant_2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
        <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">rSPtr</span><span class="main">,</span><span class="bound">nRs</span><span class="main">)</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> int <span class="bound">i</span> <span class="main">≤</span> nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span> <span class="main">(</span><span class="bound">rSPtr</span> <span class="main">=</span> None <span class="main">⟶</span> <span class="bound">nRs</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> 
                        <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> SwarmInfo.state <span class="main">(</span>swarmList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span> <span class="main">≠</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span>  <span class="main">)</span> <span class="main">∧</span>
                      <span class="main">(</span><span class="bound">rSPtr</span> <span class="main">≠</span> None <span class="main">⟶</span> <span class="bound">nRs</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sl</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span><span class="main">;</span>
                             <span class="bound">sl'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">si</span><span class="main">.</span> SwarmInfo.state <span class="bound">si</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="bound">sl</span>
                          <span class="keyword1">in</span> <span class="main">(</span>int <span class="main">(</span>length <span class="bound">sl'</span><span class="main">)</span> <span class="main">=</span> <span class="bound">nRs</span> <span class="main">∧</span> <span class="main">(</span>the <span class="bound">rSPtr</span><span class="main">)</span> <span class="main">=</span> last <span class="bound">sl'</span><span class="main">)</span> <span class="main">)</span>
                      <span class="main">)</span>  <span class="main">)</span> "</span></span></span> 
          <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">rSPtr</span><span class="main">,</span><span class="bound">nRs</span><span class="main">)</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> nat <span class="main">(</span>nSwarm <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">-</span> int <span class="bound">i</span><span class="main">)</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_findRunningSwarm_def Let_def 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_filter_length_aux0  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_eq_plus1 of_nat_less_iff<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_filter_last_aux0  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1 of_nat_less_imp_less<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 less_imp_le linorder_neqE_nat not_less_eq take_all<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 less_imp_le linorder_neqE_nat not_less_eq take_all take_filter_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> One_nat_def Suc_eq_plus1 length_append lift_Suc_mono_less_iff list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> of_nat_Suc take_filter_aux0 take_filter_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 lift_Suc_mono_less_iff of_nat_Suc take_filter_last_aux0<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_False index_less_size_conv nat_int.Rep_eqD nth_index<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function findToPauseActors
*)</span>
<span class="keyword1"><span class="command">definition</span></span> scheEqualExceptPauList <span class="main">::</span> <span class="quoted"><span class="quoted"><span class="language">"scheduler <span class="main">⇒</span> scheduler <span class="main">⇒</span> bool"</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="free">scheEqualExceptPauList</span> <span class="free"><span class="bound">s</span></span> <span class="free"><span class="bound">sche</span></span> <span class="main">≡</span>
         acbList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> acbList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         swarmList <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> swarmList <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         actorNo <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> actorNo <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         nSwarm <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> nSwarm <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheNum <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheNum <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         registeredBus <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> registeredBus <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         scheMsgQueue <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> scheMsgQueue <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         minPrioActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> minPrioActors <span class="free"><span class="bound">s</span></span> <span class="main">∧</span>
         finishingActors <span class="free"><span class="bound">sche</span></span> <span class="main">=</span> finishingActors <span class="free"><span class="bound">s</span></span> "</span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_findToPauseActors <span class="main">:</span> 
 <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">∧</span> toPauseActors <span class="free">sche</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>
  <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
    Des_findToPauseActors <span class="free">minSwarmPtr</span> <span class="free">minPrio</span>
  <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_findToPauseActors <span class="free">sche</span> <span class="free">minSwarmPtr</span> <span class="free">minPrio</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_findToPauseActors_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> length <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>scheEqualExceptPauList <span class="free">sche</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                 <span class="main">(</span> <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span>  
                   <span class="main">¬</span><span class="main">(</span> ACB.state <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span> 
                      <span class="main">(</span><span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span><span class="main">)</span> <span class="main">∨</span> 
                       <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span> 
                          ACB.prio <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">minPrio</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>  <span class="main">)</span>   <span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> 
                      <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">al</span> <span class="main">=</span> take <span class="bound">i</span>  <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
                            <span class="bound">al'</span> <span class="main">=</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span> 
                                  <span class="main">(</span> <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">≠</span> swarmID <span class="free">minSwarmPtr</span><span class="main">)</span> <span class="main">∨</span> 
                                    <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">∧</span> 
                                      ACB.prio <span class="bound">a</span> <span class="main">&gt;</span> <span class="free">minPrio</span><span class="main">)</span> <span class="main">)</span>   <span class="main">)</span>  <span class="bound">al</span><span class="main">;</span>
                            <span class="bound">al''</span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID   <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.state     <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span>
                                   ActorPluginInfo.taskInfo  <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span> <span class="bound">al'</span>
                         <span class="keyword1">in</span> <span class="bound">al''</span>    <span class="main">)</span>  <span class="main">)</span>   <span class="main">)</span>
                   "</span></span></span> 
       <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> Let_def Re_findToPauseActors_def invariant_8_def scheEqualExceptPauList_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux2<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_filter_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux2<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">rule</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_filter_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> r a
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux0<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> i <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="skolem">r</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">using</span></span> take_map_filter_aux1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_eq_plus1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a
  <span class="keyword1"><span class="command">using</span></span> map_filter_aux<span class="main">[</span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> al <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"acbList <span class="free">sche</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> 
           P <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">⦇</span>ActorPluginInfo.actorID <span class="main">=</span> ACB.actorID <span class="bound">a</span><span class="main">,</span> actorName <span class="main">=</span> ACB.name <span class="bound">a</span><span class="main">,</span>
                       state <span class="main">=</span> ACB.state <span class="bound">a</span><span class="main">,</span> taskInfo <span class="main">=</span> ACB.taskInfo <span class="bound">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span>
           Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span>  ACB.state <span class="bound">a</span> <span class="main">=</span> actorState.ACTOR_STATE_RUNNING <span class="main">∧</span>
                      <span class="main">(</span>swarmID <span class="main">(</span>pSwarmInfo <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> swarmID <span class="free">minSwarmPtr</span> <span class="main">⟶</span> <span class="free">minPrio</span> <span class="main">&lt;</span> prio <span class="bound">a</span><span class="main">)</span> <span class="main">)</span>"</span></span></span></span> <span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(* 
  Refinement Verification of Function pauseSwarmAndActors
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> pauseSwarmAndActors_aux1<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">" ACB.actorID
           <span class="main">(</span><span class="keyword1">if</span> ACB.actorID <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="free">pl</span><span class="main">)</span>
            <span class="keyword1">then</span> <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_PAUSE<span class="main">⦈</span>
            <span class="keyword1">else</span> <span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> 
            <span class="main">=</span> ACB.actorID <span class="main">(</span><span class="free">al</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>
<span class="keyword1"><span class="command">lemma</span></span> pauseSwarmAndActors_aux2<span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> 
       <span class="bound">r</span> <span class="main">&lt;</span> length <span class="free">pl</span> <span class="main">⟹</span>
       <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span>
          ActorPluginInfo.actorID <span class="main">(</span><span class="free">pl</span><span class="main">!</span><span class="bound">r</span><span class="main">)</span> <span class="main">≠</span>
          ACB.actorID <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span> <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="bound">r</span> <span class="free">pl</span><span class="main">)</span>
                   <span class="keyword1">then</span> <span class="bound">a</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_PAUSE<span class="main">⦈</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>
           <span class="free">al</span>  <span class="main">=</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span> <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="free">pl</span><span class="main">)</span>
                   <span class="keyword1">then</span> <span class="bound">a</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_PAUSE<span class="main">⦈</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>
           <span class="free">al</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_set_ACB_aux2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> image_insert index_less_size_conv insert_iff map_eq_conv nth_index take_insert_nth<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_pauseSwarmAndActors <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_pauseSwarmAndActors <span class="free">runningSwarmPtr</span> <span class="free">minSwarmPtr</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_pauseSwarmAndActors <span class="free">sche</span> <span class="free">runningSwarmPtr</span> <span class="free">minSwarmPtr</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_pauseSwarmAndActors_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>acbList <span class="main">:=</span>
                       <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">mpal</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span>
                         <span class="keyword1">in</span> Re_pauseActors <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="bound">mpal</span> <span class="main">)</span> <span class="main">⦈</span>
               "</span></span></span>           
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  validE_def throwError_def returnOk_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  Re_pauseActors_def Let_def Re_pauseSwarmAndActors_def Re_pauseSwarm_def invariant_8_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span>  <span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
                  fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>acbList <span class="main">:=</span>
                       <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">mpal</span> <span class="main">=</span> take <span class="free">r</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span>
                         <span class="keyword1">in</span> Re_pauseActors <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="bound">mpal</span> <span class="main">)</span> <span class="main">⦈</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>ActorPluginInfo.actorID <span class="main">(</span><span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span>
                                ACB.actorID <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> 
               "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  validE_def throwError_def returnOk_def Re_pauseActors_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  Re_pauseActors_def Let_def Re_pauseSwarmAndActors_def Re_pauseSwarm_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_set_ACB_aux1 map_set_ACB_aux2<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> nat_neq_iff not_less_eq pauseSwarmAndActors_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pauseSwarmAndActors_aux1 pauseSwarmAndActors_aux2<span class="main">)</span></span>


<span class="comment1">(* 
  Refinement Verification of Function runSwarmAndActors
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> runSwarmAndActors_aux1<span class="main">:</span> <span class="quoted"><span class="quoted"><span class="language">"  ACB.actorID
           <span class="main">(</span><span class="keyword1">if</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span>
               <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="free">r</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
            <span class="keyword1">then</span> <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_RUNNING<span class="main">⦈</span>
            <span class="keyword1">else</span> acbList <span class="free">sche</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span> <span class="main">=</span> ACB.actorID <span class="main">(</span>acbList <span class="free">sche</span> <span class="main">!</span> <span class="free">ra</span><span class="main">)</span>"</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span> 
<span class="keyword1"><span class="command">lemma</span></span> runSwarmAndActors_aux2<span class="main">:</span>
    <span class="quoted"><span class="quoted"><span class="language">" <span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">&lt;</span> length <span class="free">ml</span> <span class="main">⟹</span>
          <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span>length <span class="free">al</span><span class="main">.</span>
            ActorPluginInfo.actorID <span class="main">(</span><span class="free">ml</span> <span class="main">!</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≠</span>
            ACB.actorID <span class="main">(</span><span class="free">al</span><span class="main">!</span><span class="bound">j</span><span class="main">)</span> <span class="main">⟹</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span> <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="bound">r</span> <span class="free">ml</span><span class="main">)</span>
                   <span class="keyword1">then</span> <span class="bound">a</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_RUNNING<span class="main">⦈</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>
           <span class="free">al</span> <span class="main">=</span>
          map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">if</span> ACB.actorID <span class="bound">a</span> <span class="main">∈</span> ActorPluginInfo.actorID <span class="main">`</span> set <span class="main">(</span>take <span class="main">(</span>Suc <span class="bound">r</span><span class="main">)</span> <span class="free">ml</span><span class="main">)</span>
                   <span class="keyword1">then</span> <span class="bound">a</span><span class="main">⦇</span>ACB.state <span class="main">:=</span> actorState.ACTOR_STATE_RUNNING<span class="main">⦈</span> <span class="keyword1">else</span> <span class="bound">a</span><span class="main">)</span>
           <span class="free">al</span>"</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> map_set_ACB_aux2
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">smt</span> image_insert index_less_size_conv insert_iff map_eq_conv nth_index take_insert_nth<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_runSwarmAndActors <span class="main">:</span> 
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_runSwarmAndActors <span class="free">minSwarmPtr</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_runSwarmAndActors <span class="free">sche</span> <span class="free">minSwarmPtr</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_runSwarmAndActors_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoop_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span>    
                       fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>acbList <span class="main">:=</span>
                       <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">mpal</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span>
                         <span class="keyword1">in</span> Re_runActors <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="bound">mpal</span> <span class="main">)</span> <span class="main">⦈</span>     
               "</span></span></span>           
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  validE_def throwError_def returnOk_def
  <span class="keyword1"><span class="command">unfolding</span></span>  Re_runActors_def Let_def Re_runSwarmAndActors_def Re_runSwarm_def invariant_8_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subst</span> whileLoopE_add_inv
     <span class="main"><span class="main">[</span></span><span class="language"><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="bound">i</span> <span class="bound">s</span><span class="main">.</span> <span class="free">r</span> <span class="main">&lt;</span> length <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">≤</span> length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                  fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>acbList <span class="main">:=</span>
                       <span class="main">(</span> <span class="keyword1">let</span> <span class="bound">mpal</span> <span class="main">=</span> take <span class="free">r</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span>
                         <span class="keyword1">in</span> Re_runActors <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="bound">mpal</span> <span class="main">)</span> <span class="main">⦈</span> <span class="main">∧</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">&lt;</span><span class="bound">i</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span>ActorPluginInfo.actorID <span class="main">(</span><span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">!</span><span class="free">r</span><span class="main">)</span> <span class="main">=</span>
                                ACB.actorID <span class="main">(</span><span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">!</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> 
               "</span></span></span> 
      <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> M<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="language">"<span class="main">λ</span><span class="main">(</span><span class="bound">i</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>acbList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">i</span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>  <span class="keyword1"><span class="command">unfolding</span></span>  Re_runActors_def Let_def Re_runSwarmAndActors_def Re_runSwarm_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span>  validE_def throwError_def returnOk_def invariant_6_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_set_ACB_aux1 map_set_ACB_aux2<span class="main">)</span></span> 
  <span class="keyword1"><span class="command">using</span></span> less_antisym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">blast</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> runSwarmAndActors_aux1 runSwarmAndActors_aux2<span class="main">)</span></span>


<span class="comment1">(* schedule Loop*)</span>
<span class="comment1">(* 
  Refinement Verification of Function schedule
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_1 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule_1 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
           fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_1_def Re_schedule_1_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_2_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_findFinishActors <span class="main">(</span><span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⦄</span>
           Des_delFinishActors 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span> <span class="bound">sche''</span> <span class="main">=</span> Re_findFinishActors <span class="bound">sche'</span><span class="main">;</span> <span class="bound">condition2</span> <span class="main">=</span> length <span class="main">(</span>finishingActors <span class="bound">sche''</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span>
                   <span class="bound">sche'''</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="bound">condition2</span> <span class="keyword1">then</span> Re_delFinishActors <span class="bound">sche''</span> <span class="keyword1">else</span> <span class="bound">sche''</span>
               <span class="keyword1">in</span> <span class="bound">sche'''</span><span class="main">)</span><span class="main">⦄</span>
  "</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_delFinishActors<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def valid_def case_prod_unfold<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_delFinishActors <span class="main">(</span>Re_findFinishActors <span class="main">(</span><span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="improper">a</span>"</span></span></span>  <span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
                      <span class="keyword1">in</span> Bus_invariant_1 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_4 <span class="bound">sche'</span> <span class="main">∧</span> invariant_8 <span class="bound">sche'</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_findFinishActors_businv1 Re_findFinishActors_businv2 Re_findFinishActors_businv4 Re_findFinishActors_inv8 fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def Bus_invariant_1_def  Bus_invariant_2_def Bus_invariant_4_def invariant_8_def<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_2_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
         Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
         Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
         Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
         Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
         Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
         <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">⦄</span> Des_findFinishActors 
         <span class="main">⦃</span><span class="main">λ</span><span class="bound">xa</span> <span class="bound">s</span><span class="main">.</span>
             <span class="main">(</span>length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span> <span class="main">=</span> Re_findFinishActors <span class="main">(</span><span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">¬</span> length <span class="main">(</span>finishingActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟶</span>
              fst <span class="bound">s</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span> <span class="bound">sche''</span> <span class="main">=</span> Re_findFinishActors <span class="bound">sche'</span><span class="main">;</span> <span class="bound">condition2</span> <span class="main">=</span> length <span class="main">(</span>finishingActors <span class="bound">sche''</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span>
                   <span class="bound">sche'''</span> <span class="main">=</span> <span class="keyword1">if</span> <span class="bound">condition2</span> <span class="keyword1">then</span> Re_delFinishActors <span class="bound">sche''</span> <span class="keyword1">else</span> <span class="bound">sche''</span>
               <span class="keyword1">in</span> <span class="bound">sche'''</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>  "</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1 <span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_findFinishActors<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
                      <span class="keyword1">in</span> Bus_invariant_1 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_3 <span class="bound">sche'</span> <span class="main">∧</span>
                         Bus_invariant_4 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_5 <span class="bound">sche'</span> <span class="main">∧</span> invariant_8 <span class="bound">sche'</span> <span class="main">∧</span> finishingActors <span class="bound">sche'</span> <span class="main">=</span> <span class="main">[]</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def Bus_invariant_1_def  Bus_invariant_2_def Bus_invariant_4_def Bus_invariant_3_def Bus_invariant_5_def invariant_8_def<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_findFinishActors <span class="main">(</span><span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="improper">a</span>"</span></span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦇</span>finishingActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
                      <span class="keyword1">in</span> Bus_invariant_1 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_3 <span class="bound">sche'</span> <span class="main">∧</span>
                         Bus_invariant_4 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_5 <span class="bound">sche'</span> <span class="main">∧</span> invariant_8 <span class="bound">sche'</span> <span class="main">∧</span> finishingActors <span class="bound">sche'</span> <span class="main">=</span> <span class="main">[]</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def Bus_invariant_1_def  Bus_invariant_2_def Bus_invariant_4_def Bus_invariant_3_def Bus_invariant_5_def invariant_8_def<span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_2 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span> 
   Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span> 
   Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span> 
   Bus_invariant_3 <span class="free">sche</span> <span class="main">⟹</span>
   Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span> 
   Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule_2 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule_2 <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_2_def Re_schedule_2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wp</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_2_aux0<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_2_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_3_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_12 <span class="free">sche</span>
    <span class="main">∧</span> invariant_17 <span class="free">sche</span>  <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span> <span class="free">minPrio</span> <span class="main">=</span> MAX_PRIORITY<span class="main">+</span><span class="main">1</span> <span class="main">∧</span> <span class="free">minIdx</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> 
          <span class="main">(</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span><span class="bound">minSwarmPrio</span><span class="main">)</span> <span class="main">=</span> Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY<span class="main">+</span><span class="main">1</span><span class="main">)</span> 
            <span class="keyword1">in</span> <span class="free">x2</span> <span class="main">=</span> <span class="bound">minSwarmPrio</span> <span class="main">∧</span> <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span>  <span class="main">∧</span> <span class="free">condition3</span> <span class="main">=</span> <span class="main">(</span><span class="bound">minSwarmPtr</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span><span class="main">⦄</span> 
          Des_ifMinPrioSwarmHaveActor <span class="main">(</span>the <span class="free">x1</span><span class="main">)</span> <span class="free">minIdx</span> <span class="free">minPrio</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xa</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">∀</span><span class="bound">x</span> <span class="bound">xb</span><span class="main">.</span>
              <span class="bound">xa</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">,</span> <span class="bound">xb</span><span class="main">,</span> <span class="free">condition3</span><span class="main">,</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span>fst <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
               snd <span class="main">(</span>ifMinPrioSwarmHaveActor <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
               fst <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">,</span>
               fst <span class="main">(</span>ifMinPrioSwarmHaveActor <span class="main">(</span>acbList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
              fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_ifMinPrioSwarmHaveActor<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_3_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"  invariant_12 <span class="free">sche</span> <span class="main">∧</span> invariant_17 <span class="free">sche</span> <span class="main">∧</span>
      invariant_2 <span class="free">sche</span> <span class="main">∧</span> invariant_18 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>  <span class="free">minSwarmPrio</span> <span class="main">=</span> MAX_PRIORITY <span class="main">+</span><span class="main">1</span> <span class="main">∧</span>
             <span class="free">minSwarmPtr</span> <span class="main">=</span> None<span class="main">⦄</span>
           Des_findMinPrioSwarm <span class="free">minSwarmPtr</span> <span class="free">minSwarmPrio</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xa</span> <span class="bound">xaa</span><span class="main">.</span>
                 <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xa</span><span class="main">,</span> <span class="bound">xaa</span><span class="main">)</span> <span class="main">⟶</span>
                 fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
                 MAX_PRIORITY <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> MAX_PRIORITY <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
                 <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="keyword1">let</span> <span class="bound">a</span> <span class="main">=</span> Re_findMinPrioSwarm <span class="main">(</span>swarmList <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>MAX_PRIORITY <span class="main">+</span> <span class="main">1</span><span class="main">)</span>
                  <span class="keyword1">in</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">xaa</span> <span class="main">=</span> <span class="bound">minSwarmPrio</span> <span class="main">∧</span> <span class="bound">xa</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">xa</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">minSwarmPtr</span> <span class="main">=</span> None<span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_findMinPrioSwarm<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_3 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_12 <span class="free">sche</span> <span class="main">∧</span> invariant_17 <span class="free">sche</span> <span class="main">∧</span>
      invariant_2 <span class="free">sche</span> <span class="main">∧</span> invariant_18 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule_3 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> Re_schedule_3 <span class="free">sche</span> <span class="main">∧</span>
           fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_3_def Re_schedule_3_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_3_aux0<span class="main">)</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_3_aux1<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_4_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
      <span class="free">condition6</span> <span class="main">⟹</span>
       <span class="free">flag1</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>actorState.ACTOR_STATE_PAUSE<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="free">flag1</span> <span class="main">=</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>actorState.ACTOR_STATE_PAUSE<span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
              Des_pauseSwarmAndActors <span class="free">runningSwarmPtr</span> <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE<span class="main">)</span>
               <span class="keyword1">then</span> Re_pauseSwarmAndActors <span class="main">(</span>fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE<span class="main">)</span><span class="main">)</span> <span class="free">runningSwarmPtr</span>
                     <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span>
               <span class="keyword1">else</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE<span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_pauseSwarmAndActors<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command">using</span></span> Re_sche_updateActorPluginState_inv8 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span> 
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_4_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
     Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
            <span class="free">pActs</span> <span class="main">=</span> toPauseActors <span class="free">sche</span><span class="main">⦄</span>
             Des_updateActorPluginState_sche <span class="free">pActs</span> actorState.ACTOR_STATE_PAUSE 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">flag1</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">(</span><span class="bound">flag1</span> <span class="main">⟶</span>
            fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE<span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">¬</span> <span class="bound">flag1</span> <span class="main">⟶</span>
            fst <span class="bound">s</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">let</span> <span class="bound">p</span> <span class="main">=</span> Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>toPauseActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_PAUSE
             <span class="keyword1">in</span> <span class="keyword1">if</span> snd <span class="bound">p</span> <span class="keyword1">then</span> Re_pauseSwarmAndActors <span class="main">(</span>fst <span class="bound">p</span><span class="main">)</span> <span class="free">runningSwarmPtr</span> <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span> <span class="keyword1">else</span> fst <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_updateActorPluginState_sche<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1 <span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Let_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span> 
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_4 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
     Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule_4 <span class="free">condition6</span> <span class="free">minSwarmPtr</span> <span class="free">runningSwarmPtr</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule_4 <span class="free">sche</span> <span class="free">condition6</span> <span class="free">minSwarmPtr</span> <span class="free">runningSwarmPtr</span><span class="main">⦄</span>
  "</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_4_def Re_schedule_4_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_4_aux0<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_4_aux1<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_5_aux0<span class="main">:</span>
 <span class="quoted"><span class="quoted"><span class="language">"<span class="free">condition7</span> <span class="main">⟹</span>
       <span class="free">flag2</span> <span class="main">⟹</span>
       invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            True <span class="main">=</span> snd  <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> <span class="main">(</span>actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
          Des_runSwarmAndActors <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span>
               <span class="keyword1">then</span> Re_runSwarmAndActors <span class="main">(</span>fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span>
               <span class="keyword1">else</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_runSwarmAndActors<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command">using</span></span> Re_sche_updateActorPluginState_inv8 <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_5_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">∧</span>
            <span class="free">mpActs</span> <span class="main">=</span> minPrioActors <span class="free">sche</span><span class="main">⦄</span> 
          Des_updateActorPluginState_sche <span class="free">mpActs</span> actorState.ACTOR_STATE_RUNNING 
 <span class="main">⦃</span><span class="main">λ</span><span class="bound">flag2</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">(</span><span class="bound">flag2</span> <span class="main">⟶</span>
            fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span> Ros_INFO <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="inner_quoted">''[Actor Scheduler] Start the min prio actors successfully''</span><span class="main">)</span> <span class="main">=</span>
            fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span> <span class="main">∧</span>
            True <span class="main">=</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">¬</span> <span class="bound">flag2</span> <span class="main">⟶</span>
            fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span> Ros_ERROR <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="inner_quoted">''[Actor Scheduler] Start the min prio actors fails''</span><span class="main">)</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">if</span> <span class="free">condition7</span>
             <span class="keyword1">then</span> <span class="keyword1">if</span> snd <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span>
                  <span class="keyword1">then</span> Re_runSwarmAndActors <span class="main">(</span>fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span><span class="main">)</span> <span class="main">(</span>the <span class="free">minSwarmPtr</span><span class="main">)</span>
                  <span class="keyword1">else</span> fst <span class="main">(</span>Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING<span class="main">)</span>
             <span class="keyword1">else</span> <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_updateActorPluginState_sche<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1 <span class="main">)</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"Re_sche_updateActorPluginState <span class="free">sche</span> <span class="main">(</span>minPrioActors <span class="free">sche</span><span class="main">)</span> actorState.ACTOR_STATE_RUNNING <span class="main">=</span> <span class="main">(</span><span class="improper">aa</span><span class="main">,</span>False<span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_sche_updateActorPluginState_def  Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Pair_inject<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">fastforce</span></span> 
<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_5 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
     Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule_5 <span class="free">condition7</span> <span class="free">minSwarmPtr</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule_5 <span class="free">sche</span> <span class="free">condition7</span> <span class="free">minSwarmPtr</span><span class="main">⦄</span>
  "</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_5_def Re_schedule_5_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_5_aux0<span class="main">)</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_5_aux1<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux0 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
     <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span>  <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">runningSwarmPtr</span><span class="main">,</span> <span class="bound">nRunningSwarm</span><span class="main">)</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span>
                <span class="bound">condition5</span> <span class="main">=</span> <span class="main">(</span><span class="bound">nRunningSwarm</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
                <span class="bound">sche4'</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche5</span> <span class="main">=</span> Re_findToPauseActors <span class="bound">sche4'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
                <span class="bound">condition6</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>toPauseActors <span class="bound">sche5</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span><span class="main">;</span>
                <span class="bound">sche6</span> <span class="main">=</span> Re_schedule_4 <span class="bound">sche5</span> <span class="bound">condition6</span> <span class="bound">minSwarmPtr</span> <span class="bound">runningSwarmPtr</span>                
           <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span> 
              <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition5</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="free">condition7</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>minPrioActors <span class="bound">sche6</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
              <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span>
              fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche6</span> <span class="main">⦄</span>
       Des_schedule_5 <span class="free">condition7</span> <span class="free">x1</span>
     <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule_5<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def
  <span class="keyword1"><span class="command">unfolding</span></span>  Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">" <span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span>  <span class="main">(</span>Re_schedule_4
                  <span class="main">(</span>Re_findToPauseActors
                    <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                      <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                    <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>toPauseActors
                    <span class="main">(</span>Re_findToPauseActors
                      <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                        <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                        <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                      <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span>
                   <span class="main">[]</span><span class="main">)</span>
                  <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>fst <span class="main">(</span>Re_findRunningSwarm
                         <span class="main">(</span>swarmList
                           <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                             <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                             <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                    <span class="keyword1">in</span>  invariant_8 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_1 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_4 <span class="bound">sche'</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Re_schedule_def Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_8 <span class="bound">sche</span> <span class="main">⟹</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_1 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_1 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_1 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_2 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_2 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_2 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_4 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_4 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_4 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_findAcotorUnderMinSwarm_businv1 Re_findAcotorUnderMinSwarm_businv2 Re_findAcotorUnderMinSwarm_businv4 Re_findAcotorUnderMinSwarm_inv8 Re_findToPauseActors_businv1 Re_findToPauseActors_businv2 Re_findToPauseActors_businv4 Re_findToPauseActors_inv8 Re_schedule_1_businv1 Re_schedule_1_businv2 Re_schedule_1_businv4 Re_schedule_1_inv8 Re_schedule_2_businv1 Re_schedule_2_businv2 Re_schedule_2_businv4 Re_schedule_2_inv8 Re_schedule_4_businv1 Re_schedule_4_businv2 Re_schedule_4_inv8 Re_schedule_5_businv4<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_4_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_2_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_1_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_8_def<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">runningSwarmPtr</span><span class="main">,</span> <span class="bound">nRunningSwarm</span><span class="main">)</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span>
                <span class="bound">condition5</span> <span class="main">=</span> <span class="main">(</span><span class="bound">nRunningSwarm</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
                <span class="bound">sche4'</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche5</span> <span class="main">=</span> Re_findToPauseActors <span class="bound">sche4'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span>
             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition5</span> <span class="main">=</span> False <span class="main">∧</span>
                <span class="free">condition6</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>toPauseActors <span class="bound">sche5</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
                <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span>
                <span class="free">x1d</span> <span class="main">=</span> <span class="bound">runningSwarmPtr</span> <span class="main">∧</span>
                fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche5</span> <span class="main">⦄</span>
          Des_schedule_4 <span class="free">condition6</span> <span class="free">x1</span> <span class="free">x1d</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xg</span> <span class="bound">s</span><span class="main">.</span>
           <span class="keyword1">let</span> <span class="bound">a</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span><span class="main">;</span> <span class="bound">b</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
               <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="main">(</span><span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
               <span class="bound">c</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span>
               <span class="bound">sche5</span> <span class="main">=</span> Re_findToPauseActors <span class="main">(</span><span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
               <span class="bound">sche6</span> <span class="main">=</span> Re_schedule_4 <span class="bound">sche5</span> <span class="main">(</span>toPauseActors <span class="bound">sche5</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">b</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">c</span><span class="main">)</span>
           <span class="keyword1">in</span> <span class="main">¬</span> snd <span class="bound">a</span> <span class="main">∧</span>
              <span class="main">¬</span> fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">¬</span> snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>snd <span class="bound">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">¬</span> <span class="main">1</span> <span class="main">&lt;</span> snd <span class="bound">c</span> <span class="main">∧</span> <span class="main">(</span>minPrioActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>minPrioActors <span class="bound">sche6</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="free">x1</span> <span class="main">=</span> fst <span class="bound">b</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche6</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule_4<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold Let_def
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span>  <span class="main">(</span>Re_findToPauseActors
                  <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                    <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                   <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                  <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="keyword1">in</span>  invariant_8 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_1 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> Bus_invariant_4 <span class="bound">sche'</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold 
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_8 <span class="bound">sche</span> <span class="main">⟹</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_1 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_1 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_1 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_2 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_2 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_2 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> Bus_invariant_4 <span class="bound">sche</span> <span class="main">⟹</span> Bus_invariant_4 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">∧</span> Bus_invariant_4 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_findAcotorUnderMinSwarm_businv1 Re_findAcotorUnderMinSwarm_businv2 Re_findAcotorUnderMinSwarm_businv4 Re_findAcotorUnderMinSwarm_inv8 Re_findToPauseActors_businv1 Re_findToPauseActors_businv2 Re_findToPauseActors_businv4 Re_findToPauseActors_inv8 Re_schedule_1_businv1 Re_schedule_1_businv2 Re_schedule_1_businv4 Re_schedule_1_inv8 Re_schedule_2_businv1 Re_schedule_2_businv2 Re_schedule_2_businv4 Re_schedule_2_inv8<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_4_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_2_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Bus_invariant_1_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_8_def<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux2<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">runningSwarmPtr</span><span class="main">,</span> <span class="bound">nRunningSwarm</span><span class="main">)</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span>
                <span class="bound">condition5</span> <span class="main">=</span> <span class="main">(</span><span class="bound">nRunningSwarm</span> <span class="main">&gt;</span> <span class="main">1</span><span class="main">)</span><span class="main">;</span>
                <span class="bound">sche4'</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition5</span> <span class="main">=</span> False <span class="main">∧</span>
                <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="free">x1b</span> <span class="main">=</span> <span class="bound">minPrio</span> <span class="main">∧</span> <span class="free">x1d</span> <span class="main">=</span> <span class="bound">runningSwarmPtr</span> <span class="main">∧</span>
                fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche4'</span> <span class="main">⦄</span>
           Des_findToPauseActors <span class="main">(</span>the <span class="free">x1</span><span class="main">)</span> <span class="free">x1b</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xf</span> <span class="bound">s</span><span class="main">.</span>
           <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
               <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
               <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span> <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
               <span class="main">(</span><span class="bound">runningSwarmPtr</span><span class="main">,</span> <span class="bound">nRunningSwarm</span><span class="main">)</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span> <span class="bound">condition5</span> <span class="main">=</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">nRunningSwarm</span><span class="main">;</span>
               <span class="bound">sche4'</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span> <span class="bound">sche5</span> <span class="main">=</span> Re_findToPauseActors <span class="bound">sche4'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span>
           <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="bound">condition5</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="main">(</span>length <span class="main">(</span>toPauseActors <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>toPauseActors <span class="bound">sche5</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span>
              <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="free">x1d</span> <span class="main">=</span> <span class="bound">runningSwarmPtr</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche5</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_findToPauseActors<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold Let_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">aa</span> <span class="main">=</span> <span class="main">(</span>Re_findToPauseActors
          <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
          <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"toPauseActors <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">aa</span> <span class="main">=</span> <span class="main">(</span>Re_findToPauseActors
          <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
          <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"toPauseActors <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"toPauseActors <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="improper">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_8 <span class="bound">sche</span> <span class="main">⟹</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_8 <span class="bound">sche</span> <span class="main">⟹</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_findAcotorUnderMinSwarm_inv8 Re_schedule_1_inv8 Re_schedule_2_inv8 prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_8_def<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_8_def<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux3<span class="main">:</span>
   <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span>
             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> <span class="free">runningSwarmPtr</span> <span class="main">=</span> None <span class="main">∧</span>
                <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="free">x1b</span> <span class="main">=</span> <span class="bound">minPrio</span> <span class="main">∧</span> 
                <span class="free">nRunningSwarm</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche4</span> <span class="main">⦄</span>
          Des_findRunningSwarm <span class="free">runningSwarmPtr</span> <span class="free">nRunningSwarm</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xd</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span>
              <span class="bound">xd</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">xa</span> <span class="main">⟶</span>
               fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span>
                    Ros_WARN <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="inner_quoted">''[Actor Scheduler] More than one swarm actors is running, scheduleloop return''</span><span class="main">)</span> <span class="main">=</span>
               Re_schedule <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">¬</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">xa</span> <span class="main">⟶</span>
               <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                    <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                    <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span>
                    <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span><span class="main">;</span>
                    <span class="main">(</span><span class="bound">runningSwarmPtr</span><span class="main">,</span> <span class="bound">nRunningSwarm</span><span class="main">)</span> <span class="main">=</span> Re_findRunningSwarm <span class="main">(</span>swarmList <span class="bound">sche4</span><span class="main">)</span> <span class="main">0</span><span class="main">;</span>
                    <span class="bound">condition5</span> <span class="main">=</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="bound">nRunningSwarm</span><span class="main">;</span> <span class="bound">sche4'</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
                <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span>
                   <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                   <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span>
                   <span class="bound">condition5</span> <span class="main">=</span> False <span class="main">∧</span>
                   <span class="free">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="free">x1b</span> <span class="main">=</span> <span class="bound">minPrio</span><span class="main">∧</span>  <span class="bound">x</span> <span class="main">=</span> <span class="bound">runningSwarmPtr</span>  <span class="main">∧</span> fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">⦇</span>toPauseActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="bound">sche4'</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_findRunningSwarm<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold valid_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="main">(</span>Re_findAcotorUnderMinSwarm <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>
                     <span class="main">(</span>the <span class="main">(</span>fst <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>snd <span class="main">(</span>Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_schedule_def Let_def case_prod_unfold
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_2 <span class="bound">sche</span> <span class="main">⟹</span> invariant_2 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_findAcotorUnderMinSwarm_inv2 Re_schedule_1_inv2 Re_schedule_2_inv2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_2_def<span class="main">)</span></span>
  
  

<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux4<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">x1</span> <span class="bound">x1b</span><span class="main">.</span> invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
             <span class="keyword1">in</span>  <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                 <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> <span class="bound">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span>
                 <span class="bound">minPrio</span> <span class="main">=</span> <span class="bound">x1b</span> <span class="main">∧</span> 
                 fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche3'</span>  <span class="main">⦄</span>
          Des_findActorUnderMinSwarm <span class="main">(</span>the <span class="bound">x1</span><span class="main">)</span> <span class="bound">x1b</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xc</span> <span class="bound">a</span><span class="main">.</span>
           <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
               <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
               <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">;</span> <span class="bound">sche4</span> <span class="main">=</span> Re_findAcotorUnderMinSwarm <span class="bound">sche3'</span> <span class="main">(</span>the <span class="bound">minSwarmPtr</span><span class="main">)</span> <span class="bound">minPrio</span>
           <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
              <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span> None <span class="main">=</span> None <span class="main">∧</span> <span class="bound">x1</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="bound">x1b</span> <span class="main">=</span> <span class="bound">minPrio</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fst <span class="bound">a</span> <span class="main">=</span> <span class="bound">sche4</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_findActorUnderMinSwarm<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold valid_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"minPrioActors <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⋀</span><span class="bound">sche</span><span class="main">.</span> invariant_8 <span class="bound">sche</span> <span class="main">⟹</span> invariant_8 <span class="main">(</span><span class="bound">sche</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_schedule_1_inv8 Re_schedule_2_inv8
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">simp</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>invariant_8_def<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux5<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="free">sche</span> <span class="main">∧</span> 
    invariant_12 <span class="free">sche</span> <span class="main">∧</span> invariant_17 <span class="free">sche</span> <span class="main">∧</span> invariant_18 <span class="free">sche</span>  <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span>
                 <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span>
             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦄</span>
           Des_schedule_3 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">xa</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">∀</span><span class="bound">x</span> <span class="bound">xb</span><span class="main">.</span>
              <span class="bound">xa</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span> <span class="bound">xc</span><span class="main">.</span>
                  <span class="bound">xb</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xa</span><span class="main">,</span> <span class="bound">xc</span><span class="main">)</span> <span class="main">⟶</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span> <span class="bound">xb</span><span class="main">.</span>
                      <span class="bound">xc</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xa</span><span class="main">,</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">⟶</span>
                      <span class="main">(</span><span class="main">∀</span><span class="bound">xc</span> <span class="bound">xd</span><span class="main">.</span>
                          <span class="bound">xb</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xc</span><span class="main">,</span> <span class="bound">xd</span><span class="main">)</span> <span class="main">⟶</span>
                          <span class="main">(</span><span class="bound">xc</span> <span class="main">⟶</span>
                           fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span>
                                Ros_ERROR <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span>
                                 <span class="inner_quoted">''[Actor Scheduler] The minSwarm pointer is NULL, scheduleloop return''</span><span class="main">)</span> <span class="main">=</span>
                           Re_schedule <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">¬</span> <span class="bound">xc</span> <span class="main">⟶</span>
                           <span class="main">(</span><span class="bound">xd</span> <span class="main">⟶</span>
                            fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span>
                                 Ros_WARN <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span>
                                  <span class="inner_quoted">''[Actor Scheduler] The minIdx in the _acbList may be empty, scheduleloop return''</span><span class="main">)</span> <span class="main">=</span>
                            Re_schedule <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
                           <span class="main">(</span><span class="main">¬</span> <span class="bound">xd</span> <span class="main">⟶</span>
                            <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span><span class="main">;</span>
                                 <span class="main">(</span><span class="bound">minSwarmPtr</span><span class="main">,</span> <span class="bound">minSwarmPrio</span><span class="main">,</span> <span class="bound">minPrio</span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="bound">sche3</span><span class="main">;</span>
                                 <span class="bound">sche3'</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span>
                             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span>
                                <span class="bound">condition3</span> <span class="main">=</span> False <span class="main">∧</span>
                                <span class="bound">condition4</span> <span class="main">=</span> False <span class="main">∧</span>
                                <span class="bound">x</span> <span class="main">=</span> <span class="bound">minSwarmPtr</span> <span class="main">∧</span> <span class="bound">minPrio</span> <span class="main">=</span> <span class="bound">xa</span> <span class="main">∧</span> fst <span class="main">(</span>fst <span class="bound">s</span><span class="main">⦇</span>minPrioActors <span class="main">:=</span> <span class="main">[]</span><span class="main">⦈</span><span class="main">,</span> snd <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="bound">sche3'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule_3<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold valid_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Re_schedule_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">in</span> invariant_12 <span class="bound">sche'</span> <span class="main">∧</span> invariant_17 <span class="bound">sche'</span> <span class="main">∧</span>
                          invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> invariant_18 <span class="bound">sche'</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">ad</span> <span class="main">=</span> Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">in</span> <span class="bound">condition3</span> <span class="main">=</span> True "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2 fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2 fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2 fst_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2 fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2 fst_conv snd_conv<span class="main">)</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="bound">sche'</span> <span class="main">=</span> Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">in</span> invariant_12 <span class="bound">sche'</span> <span class="main">∧</span> invariant_17 <span class="bound">sche'</span> <span class="main">∧</span>
                          invariant_2 <span class="bound">sche'</span> <span class="main">∧</span> invariant_18 <span class="bound">sche'</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">ad</span> <span class="main">=</span> Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="keyword1">let</span> <span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">condition3</span><span class="main">,</span><span class="bound">condition4</span><span class="main">)</span> <span class="main">=</span> Re_schedule_3 <span class="main">(</span>Re_schedule_2 <span class="main">(</span>fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                      <span class="keyword1">in</span> <span class="bound">condition4</span> <span class="main">=</span> True <span class="main">∧</span> <span class="bound">condition3</span> <span class="main">=</span> False  "</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_schedule_1_inv12 Re_schedule_1_inv17 Re_schedule_1_inv18 Re_schedule_1_inv2 Re_schedule_2_inv12 Re_schedule_2_inv17 Re_schedule_2_inv18 Re_schedule_2_inv2<span class="main">)</span></span>

<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux6<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">∧</span>
    Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span><span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span>
             <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche1</span><span class="main">⦄</span> 
          Des_schedule_2 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">=</span> Re_schedule_1 <span class="free">sche</span><span class="main">;</span> <span class="bound">sche3</span> <span class="main">=</span> Re_schedule_2 <span class="bound">sche1</span>
              <span class="keyword1">in</span> <span class="bound">condition1</span> <span class="main">=</span> False <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche3</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule_2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def Let_def case_prod_unfold
  <span class="keyword1"><span class="command">using</span></span> Re_schedule_1_businv1 Re_schedule_1_businv2 
        Re_schedule_1_businv3 Re_schedule_1_businv4
        Re_schedule_1_businv5 Re_schedule_1_inv8
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">blast</span></span>



<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule_aux7<span class="main">:</span>
 <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_1 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_2 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span> <span class="main">⦄</span>
       Des_schedule_1 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">condition1</span> <span class="bound">s</span><span class="main">.</span>
        <span class="main">(</span><span class="bound">condition1</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">¬</span> <span class="bound">condition1</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">case</span> Re_schedule_1 <span class="free">sche</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">sche1</span><span class="main">,</span> <span class="bound">condition1</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> <span class="bound">condition1</span> <span class="main">∧</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="bound">sche1</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule_1<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span> <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold Re_schedule_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted"><span class="language">"<span class="improper">aa</span> <span class="main">=</span> fst <span class="main">(</span>Re_schedule_1 <span class="free">sche</span><span class="main">)</span>"</span></span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fst_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fst_conv snd_conv<span class="main">)</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_schedule <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_2 <span class="free">sche</span> <span class="main">∧</span>invariant_8 <span class="free">sche</span> <span class="main">∧</span> 
    invariant_12 <span class="free">sche</span> <span class="main">∧</span> invariant_17 <span class="free">sche</span> <span class="main">∧</span> invariant_18 <span class="free">sche</span> <span class="main">∧</span>
    Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
    Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">∧</span>
     Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_schedule  
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_schedule <span class="free">sche</span><span class="main">⦄</span>
  "</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_schedule_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux0<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux1<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux3<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux4<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux5<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux6<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_schedule_aux7<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>



<span class="comment1">(* 
  Refinement Verification of Function scheLoopOnce
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce1 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_scheLoopOnce1
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
           <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_scheLoopOnce1_def Re_scheLoopOnce1_def
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce2_aux0<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"ScheduleMsg.type <span class="free">msg</span> <span class="main">=</span> ScheduleMsgType.SCHEDULE_CMD_SWITCH_PRIO <span class="main">⟹</span>
   invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span><span class="free">sche</span><span class="main">⦄</span> 
        Des_switchToActor <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">result</span> <span class="bound">s</span><span class="main">.</span>
        <span class="main">(</span><span class="main">¬</span> <span class="bound">result</span> <span class="main">⟶</span>
         fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> snd <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">result</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd <span class="main">(</span>Re_switchToActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_switchToActor<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce2_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    ScheduleMsg.type <span class="free">msg</span> <span class="main">=</span> ScheduleMsgType.SCHEDULE_CMD_ACTIVATE_ACTOR <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> 
      Des_activateActor <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">result</span> <span class="bound">s</span><span class="main">.</span>
        <span class="main">(</span><span class="main">¬</span> <span class="bound">result</span> <span class="main">⟶</span>
         fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> snd <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">result</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd <span class="main">(</span>Re_activateActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> <span class="main">(</span>param3 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_activateActor<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce2_aux2<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    ScheduleMsg.type <span class="free">msg</span> <span class="main">=</span> ScheduleMsgType.SCHEDULE_CMD_YIELD_ACTOR <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
       Des_yieldActor <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span> 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">result</span> <span class="bound">s</span><span class="main">.</span>
        <span class="main">(</span><span class="main">¬</span> <span class="bound">result</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> snd <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="bound">result</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd <span class="main">(</span>Re_yieldActor <span class="free">sche</span> <span class="main">(</span>param1 <span class="free">msg</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_yieldActor<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce2 <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_8 <span class="free">sche</span>  <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_scheLoopOnce2 <span class="free">msg</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="free">sche</span> <span class="free">msg</span><span class="main">)</span> <span class="main">∧</span>
           <span class="bound">r</span> <span class="main">=</span> snd <span class="main">(</span>Re_scheLoopOnce2 <span class="free">sche</span> <span class="free">msg</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_scheLoopOnce2_def Re_scheLoopOnce2_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce2_aux0<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce2_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce2_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce_aux0<span class="main">:</span>
 <span class="quoted"><span class="quoted"><span class="language">"   invariant_2 <span class="free">sche</span> <span class="main">∧</span>
           invariant_8 <span class="free">sche</span> <span class="main">∧</span>
           invariant_12 <span class="free">sche</span> <span class="main">∧</span>
           invariant_17 <span class="free">sche</span> <span class="main">∧</span>
           invariant_18 <span class="free">sche</span> <span class="main">∧</span>
           Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
           Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">⦄</span>
           Des_schedule 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span>
              <span class="main">(</span><span class="keyword1">if</span> snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
               <span class="keyword1">then</span> <span class="keyword1">if</span> snd <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="keyword1">then</span> Re_schedule <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                    <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
               <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_schedule<span class="main">)</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_scheLoopOnce1_businv1 Re_scheLoopOnce1_businv2 Re_scheLoopOnce1_businv3 
            Re_scheLoopOnce1_businv4 Re_scheLoopOnce1_businv5 Re_scheLoopOnce1_inv12 
            Re_scheLoopOnce1_inv17 Re_scheLoopOnce1_inv18 Re_scheLoopOnce1_inv2 
            Re_scheLoopOnce1_inv8 Re_scheLoopOnce2_businv1 Re_scheLoopOnce2_businv2 
            Re_scheLoopOnce2_businv3 Re_scheLoopOnce2_businv4 Re_scheLoopOnce2_businv5 
            Re_scheLoopOnce2_inv12 Re_scheLoopOnce2_inv17 Re_scheLoopOnce2_inv18 
            Re_scheLoopOnce2_inv2 Re_scheLoopOnce2_inv8 fst_eqD snd_conv<span class="main">)</span></span> 
 
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce_aux1<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
       Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="free">x1</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">⦄</span>
           Des_scheLoopOnce2 <span class="free">x1</span> 
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">msgFlag</span> <span class="bound">s</span><span class="main">.</span>
           <span class="main">(</span><span class="bound">msgFlag</span> <span class="main">⟶</span>
            fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="main">¬</span> <span class="bound">msgFlag</span> <span class="main">⟶</span>
            fst <span class="bound">s</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">if</span> snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">then</span> <span class="keyword1">if</span> snd <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">then</span> Re_schedule <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                  <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
             <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_scheLoopOnce2<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">rule</span> req_des_appendSwarmACBs_aux1<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_scheLoopOnce1_inv8 fst_conv snd_conv<span class="main">)</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_scheLoopOnce1_inv8 prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
  <span class="keyword1"><span class="command">using</span></span> Re_scheLoopOnce1_inv8 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">force</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> Re_scheLoopOnce1_inv8 prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce_aux2<span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">" invariant_8 <span class="free">sche</span> <span class="main">⟹</span>
    Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">⟹</span>
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span> Des_scheLoopOnce1 
    <span class="main">⦃</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">xa</span> <span class="bound">xb</span><span class="main">.</span>
              <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xa</span><span class="main">,</span> <span class="bound">xb</span><span class="main">)</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="bound">xb</span> <span class="main">⟶</span> fst <span class="bound">s</span> <span class="main">=</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span> <span class="main">∧</span> snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">xa</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">¬</span> <span class="bound">xb</span> <span class="main">⟶</span>
               fst <span class="bound">s</span> <span class="main">=</span>
               <span class="main">(</span><span class="keyword1">if</span> snd <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span>
                <span class="keyword1">then</span> <span class="keyword1">if</span> snd <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="keyword1">then</span> Re_schedule <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                     <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce2 <span class="main">(</span>fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="main">(</span>snd <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                <span class="keyword1">else</span> fst <span class="main">(</span>Re_scheLoopOnce1 <span class="free">sche</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">insert</span> req_des_scheLoopOnce1<span class="main">)</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> valid_def
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">auto</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> case_prod_unfold
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> fst_conv<span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">fastforce</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
   <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="main">(</span><span class="operator">metis</span> prod_injects<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span></span> 
<span class="keyword1"><span class="command">lemma</span></span> req_des_scheLoopOnce <span class="main">:</span>
  <span class="quoted"><span class="quoted"><span class="language">"invariant_2 <span class="free">sche</span> <span class="main">∧</span>
           invariant_8 <span class="free">sche</span> <span class="main">∧</span>
           invariant_12 <span class="free">sche</span> <span class="main">∧</span>
           invariant_17 <span class="free">sche</span> <span class="main">∧</span>
           invariant_18 <span class="free">sche</span> <span class="main">∧</span>
           Bus_invariant_1 <span class="free">sche</span> <span class="main">∧</span>
           Bus_invariant_2 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_3 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_4 <span class="free">sche</span> <span class="main">∧</span> Bus_invariant_5 <span class="free">sche</span> <span class="main">⟹</span>
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
      Des_scheLoopOnce
   <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> scheLoopOnce <span class="free">sche</span><span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_scheLoopOnce_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> scheLoopOnce_def Let_def case_prod_unfold
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce_aux0<span class="main">)</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce_aux1<span class="main">)</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="language"><span class="operator">wpsimp</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="language"><span class="main">(</span><span class="operator">wpsimp</span> <span class="quasi_keyword">wp</span><span class="main"><span class="main">:</span></span>req_des_scheLoopOnce_aux2<span class="main">)</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">simp</span></span>  


<span class="comment1">(* 
  Refinement Verification of Function api_switchToActor 
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_api_switchToActor <span class="main">:</span>
      <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
       Des_api_switchToActor <span class="free">anActorID</span> <span class="free">anActorName</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_api_switchToActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_api_switchToActor_def Re_api_switchToActor_def Des_appendScheduleMsg_def Re_appendScheduleMsg_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="comment1">(* 
  Refinement Verification of Function api_activateToActor
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_api_activateToActor <span class="main">:</span>
      <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
       Des_api_activateActor <span class="free">anActorID</span> <span class="free">anActorName</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_api_activateActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="free">anActorName</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_api_activateActor_def Re_api_activateActor_def Des_appendScheduleMsg_def Re_appendScheduleMsg_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="comment1">(* 
  Refinement Verification of Function api_yieldToActor
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_api_yieldActor <span class="main">:</span>
      <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
       Des_api_yieldActor <span class="free">anActorID</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_api_yieldActor <span class="free">sche</span> <span class="free">anActorID</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_api_yieldActor_def Re_api_yieldActor_def Des_appendScheduleMsg_def Re_appendScheduleMsg_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>


<span class="comment1">(* 
  Refinement Verification of Function api_appendScheduleRequest
*)</span>
<span class="keyword1"><span class="command">lemma</span></span> req_des_api_appendScheduleRequest <span class="main">:</span>
      <span class="quoted"><span class="quoted"><span class="language">"<span class="main">⦃</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> <span class="free">sche</span><span class="main">⦄</span>
       Des_api_appendScheduleRequest <span class="free">anActorID</span>
       <span class="main">⦃</span><span class="main">λ</span><span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> fst <span class="bound">s</span> <span class="main">=</span> Re_api_appendScheduleRequest <span class="free">sche</span> <span class="free">anActorID</span> <span class="main">⦄</span>"</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Des_api_appendScheduleRequest_def Re_api_appendScheduleRequest_def Des_appendScheduleMsg_def Re_appendScheduleMsg_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="language"><span class="operator">wpsimp</span></span>

<span class="comment1">(*
lemma req_des_api_terminate :
  "⦃λs. fst s = sche⦄
    Des_api_terminate bName actID pName
   ⦃λr s. fst s = Re_api_terminate sche bName actID pName ⦄"
  unfolding Des_api_terminate_def Re_api_terminate_def
  by (wpsimp wp:req_des_api_appendScheduleRequest)
  
lemma req_des_api_pluginYieldActor :
  "⦃λs. fst s = sche⦄
    Des_api_pluginYieldActor bName actID pName
   ⦃λr s. fst s = Re_api_pluginYieldActor sche bName actID pName ⦄"
  unfolding Des_api_pluginYieldActor_def Re_api_pluginYieldActor_def 
  by (wpsimp wp: req_des_api_yieldActor)
*)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre></body>